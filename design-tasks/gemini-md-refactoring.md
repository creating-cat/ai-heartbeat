# GEMINI.md リファクタリング計画

## 問題認識

### 現状の具体的な問題
- **認知負荷の高さ**: 13セクション、約500行の大量情報でAIが処理しきれない
- **情報の散在**: 基本ルールが複数箇所に分散し、「詳細は別ファイル参照」が多すぎる
- **複雑な条件分岐**: テーマ開始活動だけで3段階の判定フローがある
- **例外処理の混在**: 基本動作と例外ケースが同じレベルで記述されている
- **実行時判断の困難**: 何をいつ参照すべきかが不明確

### 問題の影響
- AIエージェントの動作が不安定になる
- 基本的な処理で迷いが生じる
- システムの学習効率が低下する
- エラー発生時の対応が複雑化する

## 解決方針

### AIファーストな設計原則
1. **階層化された情報構造**: 重要度別の明確な分離
2. **明確な実行フロー**: 入力→判定→実行→出力の単純化
3. **構造化された情報提示**: 箇条書き、重要度表示、具体例併記
4. **予測可能性の確保**: 処理時間、副作用、期待結果の事前明示

### 新しい構造設計

```
GEMINI.md (基本動作のみ - 目標200行以内)
├── 1. 基本概念（必須理解）
├── 2. 動作モード判定（必須）
├── 3. ハートビート実行フロー（必須）
├── 4. 活動種別の詳細（必須）
├── 5. 基本制約（必須）
└── 6. 参照リソース（必要時のみ）

ai-docs/ (詳細仕様)
├── BASIC_OPERATIONS.md (基本操作の詳細)
├── ADVANCED_FEATURES.md (高度な機能)
├── EXCEPTION_HANDLING.md (例外処理)
└── 既存の詳細ドキュメント群
```

## 実装計画（完全再構築アプローチ）

### Phase 0: 既存ファイルの退避とバックアップ
**目標**: 既存の情報を安全に保管し、参照可能な状態にする

**作業内容**:
1. **退避ディレクトリの作成**
   ```
   ai-works-lib-backup/
   ├── GEMINI.md
   ├── ai-docs/
   │   ├── GUIDELINES.md
   │   ├── OPERATION_DETAILS.md
   │   ├── THEME_MANAGEMENT_GUIDE.md
   │   └── その他全ファイル
   └── backup-index.md  # 退避ファイルの一覧と概要
   ```

2. **情報の分類・整理**
   - 必須情報の特定
   - 詳細仕様の分類
   - 例外処理・エラーハンドリングの整理
   - 重複情報の特定

**成果物**: 完全なバックアップと情報分類表
**完了基準**: 全ての既存情報が安全に退避され、分類済み

### Phase 1: 新しいGEMINI.mdの完全再構築
**目標**: AIファーストな視点で基本動作のみに特化した新GEMINI.mdを作成

**作業内容**:
1. **基本構造の設計**
   ```markdown
   # AI心臓システム - 基本動作ガイド (目標: 150-200行)
   
   ## 1. システム概要 (20行)
   - 目的とコンセプト
   - ハートビートの概念
   - テーマ中心の活動
   
   ## 2. 動作モード (30行)
   - 4つのモードの明確な定義
   - モード判定フロー
   - モード宣言の方法
   
   ## 3. ハートビート実行フロー (60行)
   - 5ステップの明確な手順
   - 各ステップの具体的な作業内容
   - 完了条件
   
   ## 4. 活動種別 (60行)
   - 6つの活動の簡潔な定義
   - 実行条件と成果物
   - 推奨次回活動
   
   ## 5. 基本制約 (20行)
   - ファイル操作範囲
   - 時間制限の基本
   - 完了報告の重要性
   
   ## 6. 詳細情報への参照 (10行)
   - 必要時のみ参照するリソース一覧
   ```

2. **情報の厳選と簡潔化**
   - 基本動作に必要な情報のみを抽出
   - 例外処理は完全に別ファイル化
   - 具体例を活用した理解しやすい記述

3. **構造化された情報提示**
   - 箇条書きと番号リストの活用
   - 重要度の明示（必須/推奨/任意）
   - 予測可能な動作パターンの明示

**成果物**: 新しいGEMINI.md（完全新規作成）
**完了基準**: AIが迷わずに基本動作を実行でき、200行以内

### Phase 2: 詳細ドキュメント群の再構築
**目標**: 新しいGEMINI.mdと連携する詳細ドキュメント群を再構築

**作業内容**:
1. **新しいドキュメント構造の設計**
   ```
   ai-docs/
   ├── BASIC_OPERATIONS.md      # 基本操作の詳細手順
   ├── ACTIVITY_DETAILS.md      # 各活動種別の詳細ガイド
   ├── THEME_SYSTEM.md          # テーマ・サブテーマ管理統合版
   ├── TOOL_USAGE.md            # MCPツール使用ガイド
   ├── ERROR_HANDLING.md        # エラー・例外処理完全版
   ├── ADVANCED_FEATURES.md     # 高度な機能（deep_work等）
   └── TROUBLESHOOTING.md       # トラブルシューティング
   ```

2. **退避ファイルからの情報移植**
   - 必要な情報を新しい構造に合わせて再編成
   - 重複の排除と情報の統合
   - 参照関係の最適化

3. **参照システムの構築**
   ```
   基本動作: GEMINI.mdのみで完結
   詳細確認: 該当するai-docs/ファイルを参照
   問題発生: ERROR_HANDLING.md → TROUBLESHOOTING.md
   ```

**成果物**: 新しい詳細ドキュメント群
**完了基準**: 新GEMINI.mdとの連携が適切で、情報の重複がない

### Phase 3: 抜け漏れチェックと最適化
**目標**: 退避ファイルとの比較による抜け漏れ確認と最終調整

**作業内容**:
1. **機能網羅性の確認**
   - 退避したGEMINI.mdとの機能比較
   - 重要な機能の抜け漏れチェック
   - 必要に応じて情報の追加・調整

2. **詳細ドキュメントの網羅性確認**
   - 退避したai-docs/との内容比較
   - 重要な運用ノウハウの移植確認
   - 参照関係の整合性確認

3. **AIファースト最適化**
   ```markdown
   # 活動種別: 思考活動
   **実行条件**: テーマが設定済み
   **実行手順**: 
   1. テーマ関連の新しい視点を生成
   2. 思考過程をファイルに記録
   3. 活動ログを作成
   **成果物**: 思考ファイル、活動ログ
   **推奨次回**: 観測活動または創造活動
   **所要時間**: 5-15分
   ```

4. **予測可能性の向上**
   - 各活動の標準的な所要時間を明示
   - 副作用（ファイル作成、状態変更）を事前通知
   - 期待される結果を具体的に記述

**成果物**: 完成版GEMINI.mdと詳細ドキュメント群
**完了基準**: 機能の抜け漏れがなく、AIエージェントが安定動作

## 具体的な改善例

### 現在の問題例
```markdown
#### テーマ開始活動（最優先）
* **目的**: 新しいテーマまたはサブテーマでの活動を開始する。
* **THEME_START_IDの設定**: 現在のハートビートのIDを「THEME_START_ID」として記録し、テーマ期間中の基準とする

**開始判定フロー**:
**テーマ開始活動の流れ**:
1. 現在テーマ存在確認
2. テーマ選択
   - **現在テーマなし**: themebox確認 → 自律的決定
   - **現在テーマあり**: 決定済みサブテーマから選択
3. 共通テーマ開始処理: ディレクトリ作成 → 履歴記録 → 専門家コンテキスト検討・設定 → 活動ログ記録
```

### 改善後
```markdown
#### テーマ開始活動
**実行条件**: 現在テーマなし OR サブテーマ開始決定済み
**実行手順**:
1. テーマ選択: themebox確認 → 自律決定
2. ディレクトリ作成: `artifacts/{ハートビートID_テーマ名}/`
3. 履歴記録: テーマ開始をログに記録
4. 活動ログ作成: 開始内容を記録

**成果物**: テーマディレクトリ、開始履歴、活動ログ
**次回推奨**: 思考活動または観測活動
**所要時間**: 3-8分
**詳細手順**: THEME_MANAGEMENT_GUIDE.md参照（必要時のみ）
```

## 期待される効果

### システム面
- AIエージェントの動作安定性向上
- 基本処理での迷いの解消
- エラー発生率の低下
- 学習効率の向上

### 運用面
- ドキュメント保守の効率化
- 新機能追加時の影響範囲の明確化
- トラブルシューティングの簡素化

### 成長面
- AIの自律的判断能力の向上
- 創造的活動への集中力向上
- システム理解の深化

## リスクと対策

### 想定されるリスク
1. **情報不足による動作不安定**: 基本情報の削りすぎ
2. **参照の複雑化**: 詳細情報へのアクセスが困難
3. **既存機能の破綻**: 現在の動作パターンの変更による影響

### 対策
1. **段階的実装**: Phase毎の動作確認と調整
2. **バックアップ保持**: 現在のGEMINI.mdを保存
3. **テスト実行**: 各Phaseでの動作テスト実施

## 完了判定基準

### Phase 1完了基準
- [ ] 新しいGEMINI.mdが200行以内
- [ ] 基本的な6活動が迷わず実行可能
- [ ] モード判定が明確に動作

### Phase 2完了基準
- [ ] 詳細ドキュメントが適切に分離
- [ ] 基本動作で詳細参照が不要
- [ ] 参照タイミングが明確

### Phase 3完了基準
- [ ] AIエージェントの動作が安定
- [ ] 認知負荷の軽減を確認
- [ ] 学習効率の向上を確認

### 全体完了基準
- [ ] AIエージェントが新しいGEMINI.mdで安定動作
- [ ] システム保守性の向上
- [ ] ドキュメント品質の向上

## 次のステップ

1. **Phase 1の詳細設計**: 新しいGEMINI.mdの具体的な構造設計
2. **必須情報の抽出**: 現在のGEMINI.mdから本当に必要な情報のみを特定
3. **実装開始**: 新しいGEMINI.mdの作成

---

**作業見積もり**: 
- Phase 0: 0.5日（退避・分類）
- Phase 1: 1-2日（新GEMINI.md作成）
- Phase 2: 2-3日（詳細ドキュメント再構築）
- Phase 3: 1-2日（抜け漏れチェック・最適化）
- 全体テスト・調整: 1-2日

**優先度**: 高（AIエージェントの安定動作に直結）
**影響範囲**: AI心臓システム全体
**担当者**: システム設計者 + AIエージェント（テスト協力）