# AI向けドキュメントにおける曖昧・不整合な手順の明確化

## 1. 問題点 (What)

AI向けドキュメント群 (`GEMINI.md`, `ai-docs/`) の一部に、AIの誤動作を誘発しかねない、曖昧または不整合な手順の記述が存在する。

具体的には、以下の問題が確認された。

1.  **情報の不整合**:
    -   `ERROR_HANDLING.md`にて、`create_theme_log`ツールのエラーに対する解決策として、無関係な`create_theme_expert_context`ツールの実行が指示されている。

2.  **情報の曖昧さ**:
    -   `ERROR_HANDLING.md`にて、「必要に応じて追加の処理を実行する」といった、AIが具体的な行動を判断できない抽象的な指示が存在する。

3.  **情報の粒度の乖離とリスク**:
    -   `ACTIVITY_DETAILS.md`の「テーマ開始活動」や「テーマ終了活動」の基本手順が簡潔すぎる。これにより、AIが詳細ドキュメントである`THEME_SYSTEM.md`を参照せずに不完全な手順を実行し、処理済みファイルのマーキング漏れなどの誤動作を引き起こすリスクがある。

4.  **重要な情報への誘導不足**:
    -   `GEMINI.md`の「時間制限」の項目では、長時間プロセスのリスクや具体的な回避策（`timeout`コマンドの使用など）への言及が不十分。最も重要な技術的制約は`BASIC_OPERATIONS.md`に記載されているが、`GEMINI.md`から直接参照するよう強く促されていないため、AIが見逃す可能性がある。

## 2. なぜやるのか (Why)

-   **AIの誤動作防止**: 不完全または不正確な情報に基づくAIの誤った判断や行動を防ぎ、システムの安定性を向上させる。
-   **判断コストの削減**: AIが「どちらの情報を信じるべきか」「何をすべきか」と迷う状況をなくし、より迅速で的確な意思決定を支援する。
-   **ドキュメントの信頼性向上**: 情報の単一化（Single Source of Truth）を徹底し、ドキュメント間の不整合を解消する。
-   **AIファースト設計の徹底**: AIが迷わず、安全にタスクを遂行できる、明確で構造化された指示を提供する。

## 3. 修正対象 (Where)

-   `ai-works-lib/ai-docs/ERROR_HANDLING.md`
-   `ai-works-lib/ai-docs/ACTIVITY_DETAILS.md`
-   `ai-works-lib/GEMINI.md`

## 4. 具体的な修正内容 (How)

### `ERROR_HANDLING.md` の修正

-   `create_theme_log`エラーの対処法を、エラー原因に即した正しい内容（例：「次のハートビートで再試行する」など）に修正する。
-   「必要に応じて」のような曖昧な表現を削除し、具体的な判断基準や手順を記述する。
-   「活動ログ頻度異常」の対処法に、`checkpoint`ツールの使用やタスク分割の思考法など、関連ドキュメントへの明確な参照を追加する。

### `ACTIVITY_DETAILS.md` の修正

-   「2. テーマ開始活動」と「7. テーマ終了活動」のセクションから、誤解を招く可能性のある簡潔な「基本手順」のリストを削除する。
-   代わりに、詳細な手順が記載されている`THEME_SYSTEM.md`を参照するよう、より強く、明確に誘導する記述に一本化する。

### `GEMINI.md` の修正

-   「6. 基本制約」 > 「時間制限」のセクションに、長時間プロセス（例: `npm run dev`）をそのまま実行した場合の技術的リスク（ハートビートが受信できなくなり、異常検知が作動する）を明確に追記する。
-   リスク回避策として、`BASIC_OPERATIONS.md`に記載されている`timeout`コマンドの使用を強く推奨する記述を追加する。

## 5. 完了の判断基準 (When)

-   [ ] `ERROR_HANDLING.md`の不整合・曖昧な記述が修正されている。
-   [ ] `ACTIVITY_DETAILS.md`から誤解を招く手順が削除され、詳細ドキュメントへの参照に一本化されている。
-   [ ] `GEMINI.md`に長時間プロセスのリスクと具体的な回避策への言及が追加されている。
-   [ ] 全ての修正が、AIの誤動作を防ぎ、判断を容易にするという目的に沿っている。

## 6. 見積もり

-   工数: 1.0h
-   優先度: 高