# テーマ専門家コンテキスト見直し機能 設計ドキュメント

## 概要

AI心臓システムにおいて、テーマの進行に伴って専門家コンテキストの見直しが必要になるケースに対応する機能の設計。内省活動時に専門家コンテキストの適切性を評価し、必要に応じて更新する仕組みを提供する。

## 背景・課題

### 現状の問題
- **初期判断の限界**: テーマ開始時は全体像が見えず、適切な専門家像を設定しにくい
- **テーマの進化**: 活動を進めるうちにテーマの本質や必要なスキルセットが変化
- **フェーズ変化**: 研究→実装→管理など、フェーズごとで求められる専門性が変わる
- **統合の必要性**: 複数の専門領域を統括する視点が後から必要になる

### 具体的なケース例
1. **技術プロジェクト**: "プログラマー" → "プロジェクトマネージャー"
2. **研究テーマ**: "研究者" → "研究者兼実践者"
3. **創作活動**: "作家" → "作家兼編集者兼マーケター"
4. **複合テーマ**: "ボードゲームデザイナー兼Web開発者" → "プロジェクトマネージャー（ゲーム開発・Web開発統括）"

## 機能設計

### 基本方針
- **内省活動への統合**: 既存の内省活動に専門家コンテキスト評価を追加
- **段階的更新**: 既存コンテキストを破棄せず、履歴を保持して追記
- **判定基準の明確化**: 見直しが必要な状況を具体的に定義
- **簡潔な実装**: 既存システムへの影響を最小限に抑制

### 判定基準

#### 専門家コンテキスト見直しが必要な状況
1. **役割のミスマッチ**
   - 現在の専門家設定では対応しきれない活動が増えている
   - 専門外の領域での活動が頻繁になっている

2. **フェーズ変化**
   - テーマの進行段階が変わり、必要なスキルセットが変化
   - 研究→開発→運用など、明確なフェーズ移行がある

3. **統合の必要性**
   - 複数の専門領域を統括する視点が必要になった
   - 個別スキルよりも全体管理の視点が重要になった

4. **深度の変化**
   - より専門的な知識が必要になった
   - より俯瞰的・戦略的な視点が必要になった

5. **効率性の問題**
   - 現在の専門家設定では活動効率が悪い
   - 別の専門家像の方が明らかに適している

### 見直しプロセス

#### ステップ1: 現状分析
- 最近の活動内容と現在の専門家設定のギャップを確認
- 対応しきれていない領域や不足している視点を特定
- 活動効率や成果の質への影響を評価

#### ステップ2: 必要性評価
- 見直しの必要性を5段階で評価
  - 5: 緊急に必要（現在の設定では明らかに不適切）
  - 4: 必要（見直しにより大幅な改善が期待）
  - 3: 検討の余地あり（改善の可能性がある）
  - 2: 現状維持でも可（軽微な問題のみ）
  - 1: 見直し不要（現在の設定が適切）

#### ステップ3: 新コンテキスト設計
- より適切な専門家像を設計
- 必要なスキルセット、視点、役割を明確化
- 既存の専門性との関連性を考慮

#### ステップ4: 更新実行
- 新しいコンテキストファイルの作成（`contexts/{heartbeat_id}.md`）
- 活動ログでの変更理由記録
- 次回活動での新コンテキスト適用

## MCPツール拡張

### 新しいMCPツール: `get_latest_theme_context`
```typescript
export const getLatestThemeContextInputSchema = z.object({
  themeStartId: z.string().regex(/^\d{14}$/),
  themeDirectoryPart: z.string(),
});

// 機能: 指定テーマのcontexts/フォルダ内の最新ファイルを取得
// 実装: ファイル名でソートして最新のハートビートIDを特定
```

### 既存ツールの拡張: `create_theme_expert_context`
- 保存先を `contexts/{heartbeat_id}.md` に変更
- contexts/ フォルダの自動作成
- 既存の機能はそのまま維持

## 実装仕様

### ai-docs/GUIDELINES.md への追加

#### 5.1 内省処理での自己点検項目（拡張）
```markdown
### 5.1 内省処理での自己点検項目
* **ルール遵守**: 実行ルールの遵守状況を自己点検
* **思考傾向**: 直近サイクルのログを読み返し思考傾向を自己評価
* **バランス確認**: 処理種別のバランスを確認
* **効率性評価**: 連続処理の適切性等を評価
* **サブテーマ判定**: 現在のテーマが大きすぎる場合、サブテーマ分割を検討
* **🆕 専門家コンテキスト評価**: 現在の専門家設定の適切性を評価、必要に応じて見直し

#### 専門家コンテキスト評価の詳細
以下の観点から現在の専門家設定を評価し、必要に応じて見直しを実行：

**評価観点**:
- 役割のミスマッチ（対応しきれない活動の増加）
- フェーズ変化（必要なスキルセットの変化）
- 統合の必要性（複数領域の統括視点の必要性）
- 深度の変化（より専門的 or 俯瞰的な視点の必要性）
- 効率性の問題（別の専門家像の方が適している）

**見直し手順**:
1. 現状分析: 活動内容と専門家設定のギャップ確認
2. 必要性評価: 見直しの必要性を5段階で評価
3. 新コンテキスト設計: より適切な専門家像を設計
4. 更新実行: 新しいコンテキストファイルの作成
```

### ファイル管理方式

#### ディレクトリ構造
```
ai-works/artifacts/20250115143000_boardgame_project/
├── contexts/                     # 専門家コンテキスト履歴
│   ├── 20250115143000.md         # 初期設定
│   └── 20250115160000.md         # 見直し後
├── histories/                    # 活動ログ履歴
│   ├── 20250115143000.md
│   ├── 20250115150000.md
│   └── 20250115160000.md
├── 20250115145000_game_rules.md  # 成果物
├── 20250115155000_site_design.md # 成果物
└── subthemes/                    # サブテーマ（将来実装）
    └── 20250115170000_web_dev/
```

#### コンテキストファイル形式
各コンテキストファイル（`contexts/{heartbeat_id}.md`）は以下の形式で作成：

```markdown
# テーマ専門家コンテキスト

## 専門家設定
**プロジェクトマネージャー（ゲーム開発・Web開発統括）**

## 専門性・役割
- ボードゲーム制作とWebサイト構築の両方を統括管理
- 全体スケジュール管理、リソース配分、品質管理
- 各専門領域の基礎知識を持ちつつ、統合的な視点で判断
- ステークホルダー間の調整と意思決定

## 重要な視点
- 全体最適化の観点
- リスク管理と課題解決
- 効率的なリソース活用
- 品質と納期のバランス
```

#### ファイル管理の利点
1. **構造の明確性**: `contexts/` と `histories/` で役割が明確
2. **スケーラビリティ**: コンテキストファイルが増えても整理されている
3. **トレーサビリティ**: ハートビートIDで更新タイミングが明確
4. **シンプルさ**: 各ファイルは純粋なコンテキスト内容のみ

### 活動ログ記録例

#### 専門家コンテキスト見直しを実行した場合
```markdown
## 活動種別
内省

## 活動内容
- 最近5回のハートビートを振り返り、活動内容を分析
- ボードゲーム制作とサイト構築で個別作業よりも統括管理の課題が顕在化
- 現在の「ボードゲームデザイナー兼Web開発者」では全体最適化の視点が不足
- **専門家コンテキスト見直しを実行**: 「プロジェクトマネージャー」視点に更新
- context.mdを履歴保持形式で更新完了

## 成果物、関連ファイル
- ai-works/artifacts/20250115143000_boardgame_project/contexts/20250115160000.md

## 自己評価、備考
専門家コンテキストの見直しにより、今後はプロジェクト全体の効率化と品質向上に焦点を当てた活動が可能になる。必要性レベル4と評価し、大幅な改善を期待。
```

## 導入手順

### フェーズ1: ドキュメント更新
1. ai-docs/GUIDELINES.md の更新
2. 内省時の評価基準と手順の明文化

### フェーズ2: 実践テスト
1. 実際のテーマで内省時評価を実行
2. 新しいコンテキストファイル作成の実践
3. 効果の確認と改善点の特定

### フェーズ3: 改善・最適化
1. 判定基準の調整
2. 更新プロセスの最適化
3. ドキュメントの改善

## 期待効果

### 短期効果
- より適切な専門家視点での活動
- 活動効率の向上
- 成果物の質の向上

### 長期効果
- AIの自己改善能力の向上
- テーマ設計スキルの向上
- 柔軟な専門性の獲得

## 注意事項

### 過度な変更の回避
- 頻繁すぎる専門家コンテキストの変更は避ける
- 明確な必要性がある場合のみ実行
- 変更理由を明確に記録

### 履歴の保持
- 既存のコンテキストファイルを削除しない
- contexts/ フォルダ内にハートビートID順で保存
- 必要に応じて以前の設定に戻れるようにする

---

*このドキュメントは実装の進行に伴って継続的に更新されます*