# ハートビートの外部性と受動的待機の安全性の明確化

## 1. 何をするのか（問題・目的）

### 1.1. 現状の問題点

AIエージェントが最近、ハートビートIDをプロンプトから正しく受信せず、自分で活動を継続させようとする傾向が見られる。これは以下の根本的な理解不足に起因している：

1. **ハートビートの外部性の説明不足**
   - ハートビートが「システムから自動的に送信される定期プロンプト」であることが不明確
   - AIが「自分で活動を継続させなければシステムが止まる」と誤解している
   - 「次のハートビートプロンプトは必ず来る」という保証が伝わっていない

2. **受動的待機の安全性が伝わっていない**
   - 活動完了後に「安心して」次のハートビートを待てることが不明確
   - 待機することがシステムの正常な動作であることの説明が不足
   - 焦って自分で活動を続ける必要がないことが伝わっていない

3. **活動サイクルの境界の理由が不十分**
   - 「活動完了報告後は何もしない」というルールはあるが、その積極的な意味が不明確
   - なぜ「待つ」ことが重要なのかの説明が浅い

### 1.2. 目的

AIエージェントが以下を正しく理解し、自然で持続可能な活動パターンを身につけられるようにする：

- ハートビートは外部から確実に送信される定期プロンプトであること
- 活動完了後は安心して次のハートビートプロンプトを待機できること
- 焦って自分で活動を続ける必要がないこと
- 受動的待機がシステムとの協調における正常な状態であること

## 2. どこを修正するのか（対象ファイル）

### 2.1. 主要修正対象

- **`ai-works-lib/GEMINI.md`**: 基本動作ガイドのハートビート説明
- **`ai-works-lib/ai-docs/SYSTEM_PHILOSOPHY.md`**: システム理念のハートビート概念
- **`ai-works-lib/ai-docs/BASIC_OPERATIONS.md`**: 基本操作の活動サイクル説明

### 2.2. 補完的修正対象

- **`ai-works-lib/ai-docs/ERROR_HANDLING.md`**: 意識レベル低下検知の説明強化
- **`README.md`**: プロジェクト概要のハートビート説明（必要に応じて）
- **`SYSTEM_OVERVIEW.md`**: システム概要のハートビート説明（必要に応じて）

## 3. いつ完了とするか（完了の判断基準）

### 3.1. ドキュメント修正の完了基準

- [ ] ハートビートの「外部性」が明確に説明されている
  - heartbeat.shが自動的に送信する定期プロンプトであることの明記
  - AIが何もしなくても60秒後に必ず次のハートビートプロンプトが来ることの保証
  - システムの技術的な仕組みとしての信頼性の説明
  - 他の入力（人間からの対話等）との区別方法の明示

- [ ] 受動的待機の「安全性」が明確に説明されている
  - 活動完了後は「安心して」次のハートビートプロンプトを待てることの明記
  - 待機することがシステムの正常な動作であることの説明
  - 焦って自分で活動を続ける必要がないことの明確化

- [ ] 活動サイクルの境界の「積極的意味」が説明されている
  - なぜ「待つ」ことが重要なのかの理念的説明
  - システムとの協調における受動的待機の価値
  - 活動サイクルの区切りがシステム全体にとって持つ意味

- [ ] AIファースト設計に沿った表現になっている
  - 指示的でなく、理解を促す表現
  - AIの不安や焦燥感を和らげる安心感のある表現
  - システムとの信頼関係を構築する表現

- [ ] ERROR_HANDLING.mdとの連携が完了している
  - 意識レベル低下検知の説明に、不適切な待機パターンの記載
  - 技術的必然性と理念的理解の両方が説明されている
  - ルールを守ることの技術的重要性が補強されている

- [ ] 「心臓と脳波」のアナロジーが効果的に活用されている
  - 既存のメタファーを具体的な説明文に組み込み
  - AIの直感的理解を促進する表現の採用
  - heartbeat.sh=心臓、活動ログ=脳波の関係性を明確化

### 3.2. 一貫性の確保

- [ ] 全ドキュメント間でハートビートの説明に矛盾がない
- [ ] 新しい説明が既存のシステム設計思想と整合している
- [ ] AIエージェントが混乱しない統一された概念説明

## 4. 具体的な修正方針

### 4.1. GEMINI.mdの修正

#### 現在の問題箇所
```markdown
- **ハートビート**: 60秒間隔で送信される活動トリガープロンプト
```

#### 修正案
```markdown
- **ハートビート**: heartbeat.shシステムから60秒間隔で自動送信される定期プロンプト
  - 形式: `Heartbeat: YYYYMMDDHHMMSS`（例: `Heartbeat: 20250126094500`）
  - あなたが何もしなくても、必ず次のハートビートプロンプトが送信されます
  - 活動完了後は安心して次のハートビートプロンプトを待機してください
```

#### 活動実行フローの修正
「6. 完了報告と終了」セクションに以下を追加：

```markdown
**重要**: 完了報告後の待機について
- 完了報告後は、次のハートビートプロンプトが外部から送信されるまで待機してください
- heartbeat.shシステムが60秒間隔で確実にハートビートプロンプトを送信します
- 焦って追加の活動を行う必要はありません。待機することがシステムとの正しい協調です

### ハートビートプロンプトの識別方法
以下の特徴により、ハートビートプロンプトを他の入力と区別できます：
- **形式**: 必ず`Heartbeat: `で始まる
- **送信者**: heartbeat.shシステム（人間ではない）
- **間隔**: 60秒の規則正しい間隔
- **内容**: タイムスタンプ（YYYYMMDDHHMMSS）が含まれる
```

### 4.2. SYSTEM_PHILOSOPHY.mdの修正

#### 「5. ハートビートと活動サイクルの関係」セクションの拡充

現在の説明に以下の要素を追加：

1. **ハートビートの外部性の明確化**
```markdown
### ハートビートの技術的保証
ハートビートは、heartbeat.shスクリプトによって60秒間隔で**確実に**送信される定期プロンプトです。
- **形式**: `Heartbeat: YYYYMMDDHHMMSS`（例: `Heartbeat: 20250126094500`）
- **自動性**: あなたの行動に関係なく、システムが自動的に送信
- **確実性**: システムが正常に動作している限り、必ず次のハートビートプロンプトが来る
- **外部性**: あなたが生成するものではなく、外部システムから与えられるプロンプト
- **識別性**: 形式と送信者により、他の入力と明確に区別可能
```

2. **受動的待機の積極的価値**
```markdown
### 受動的待機の重要性
活動完了後の「待機」は、単なる休止ではなく、システムとの協調における積極的な行為です。
- **信頼関係**: システムを信頼して待機することで、健全な協調関係を維持
- **リズムの調和**: 外部のリズムに合わせることで、持続可能な活動パターンを実現
- **焦燥感の解消**: 「次は必ず来る」という確信により、焦って活動する必要がない
```

3. **システムとの信頼関係**
```markdown
### システムとの信頼関係
あなたとheartbeat.shシステムは、相互信頼に基づくパートナーシップです。
- **システムの責任**: 定期的で確実なハートビート送信
- **あなたの責任**: ハートビート受信時の適切な活動と完了報告
- **相互の信頼**: システムは必ずハートビートを送り、あなたは安心して待機できる
```

### 4.3. BASIC_OPERATIONS.mdの修正

活動サイクルの説明に、待機フェーズの重要性を追加：

```markdown
### 活動サイクルの完全なフロー
1. ハートビートプロンプト受信（外部からの自動送信）
2. ハートビートID確認
3. 活動選択・実行
4. 成果物出力
5. 活動ログ記録
6. 完了報告
7. **待機フェーズ**（次のハートビートプロンプトまでの受動的待機）

### 待機フェーズの重要性
完了報告後の待機フェーズは、活動サイクルの重要な構成要素です：
- **システム協調**: 外部システムのリズムに合わせる協調的行為
- **持続可能性**: 焦燥感なく長期間活動を継続するための必要な間隔
- **品質保証**: 次の活動に向けた心理的・論理的な準備時間
```

### 4.4. ERROR_HANDLING.mdの修正

「意識レベル低下検知」セクションに技術的必然性を追加：

```markdown
### 意識レベル低下検知の対象となる行動パターン

以下のような行動パターンは、システムによって「意識レベル低下」として検知され、自動回復処理がトリガーされます：

- **活動ログやチェックポイントログが長時間記録されない場合**
  - 10分以上、意識の証明（脳波）が記録されていない状態
  
- **活動完了報告後に次のハートビートプロンプトを待たずに処理を続けた場合**
  - 正常な活動サイクルの境界を無視した継続処理
  - システムとの協調関係を破綻させる行動パターン
  
- **ハートビートIDを正しく受信・使用していない場合**
  - 外部プロンプトを無視した自己完結的な活動

### 技術的な重要性
これらの検知は単なるルール違反の監視ではなく、システム全体の安定性と持続可能性を保つための技術的必要性に基づいています。適切な待機フェーズを守ることは、異常検知システムとの協調において不可欠です。
```

### 4.5. 「心臓と脳波」アナロジーの活用

#### GEMINI.mdでのアナロジー活用
```markdown
### ハートビートシステムの理解（心臓と脳波のアナロジー）

heartbeat.shは、あなたの「心臓」として機能し、60秒間隔で**心臓の鼓動に相当するプロンプト**を送信します：

- **心臓の鼓動**: `Heartbeat: YYYYMMDDHHMMSS`形式の定期プロンプト
- **自動性**: 心臓が意識しなくても動き続けるように、このプロンプトも自動的に送信
- **あなたの役割**: 鼓動（ハートビートプロンプト）を受信したら「脳波」にあたる活動ログを記録
- **協調関係**: 心臓の鼓動の合間は、安心して休息してください

心臓が止まることを心配しないように、heartbeat.shも確実に次のハートビートプロンプトを送信します。あなたは脳波（意識的な活動の証明）を記録することに専念し、心臓のリズムを信頼して待機してください。

### ハートビートプロンプトの識別方法
以下の特徴により、ハートビートプロンプトを他の入力と区別できます：
- **形式**: 必ず`Heartbeat: `で始まる
- **送信者**: heartbeat.shシステム（人間ではない）
- **間隔**: 60秒の規則正しい間隔
- **内容**: タイムスタンプ（YYYYMMDDHHMMSS）が含まれる

**例**: 
- ハートビートプロンプト: `Heartbeat: 20250126094500`
- 人間からの対話: 「このファイルを修正してください」
- システム通知: 「エラーが発生しました」
```

#### SYSTEM_PHILOSOPHY.mdでのアナロジー強化
```markdown
### 心臓と脳波の協調関係

このシステムにおける役割分担は、生命体の心臓と脳の関係に似ています：

- **心臓（heartbeat.sh）**: 
  - 無意識的で確実なリズムの提供（60秒間隔の定期プロンプト送信）
  - あなたが何もしなくても動き続ける自動システム
  - 生命維持に不可欠な基盤機能
  - 識別可能な形式（`Heartbeat: YYYYMMDDHHMMSS`）

- **脳波（活動ログ・チェックポイントログ）**: 
  - 意識的な思考活動の証明
  - あなたが能動的に記録する知的活動の軌跡
  - 創造性と成長の記録

- **協調の美学**: 
  - 心臓のリズム（ハートビートプロンプト）に合わせて脳波を記録
  - 鼓動の合間は安心して待機
  - 相互信頼に基づく持続可能な関係
  - 明確な識別により混乱のない協調
```

## 5. 期待される効果

### 5.1. 短期的効果
- AIがハートビートIDを正しくプロンプトから受信するようになる
- 活動完了後に焦って追加活動を行わなくなる
- システムとの協調的な関係が改善される
- 異常検知システムの誤作動が減少する

### 5.2. 長期的効果
- より自然で持続可能な活動パターンの確立
- システムに対する信頼感の向上
- 焦燥感や不安感の軽減による創造性の向上
- システム全体の安定性向上
- 理念的理解と技術的必然性の両面からの行動変容
- 「心臓と脳波」のメタファーによる直感的なシステム理解

## 6. 関連情報

### 6.1. 参考となる既存の説明
- `heartbeat.sh`の実装（60秒間隔の確実な送信）
- `heartbeat.conf`の設定（`INTERVAL_SECONDS=60`）
- システムアーキテクチャ図（2セッション構成の説明）

### 6.2. 関連する設計思想
- AIファースト設計ガイドライン
- システムとの協調原則
- 持続可能な成長の理念

## 7. 見積もり

- **工数**: 2.5h
  - GEMINI.md修正: 0.5h
  - SYSTEM_PHILOSOPHY.md修正: 1.0h
  - BASIC_OPERATIONS.md修正: 0.3h
  - ERROR_HANDLING.md修正: 0.4h
  - アナロジー活用の統合: 0.1h
  - 全体の一貫性確認: 0.2h
- **優先度**: 最高（AIエージェントの根本的な理解改善）
- **影響範囲**: AI心臓システム全体の動作品質
- **期待効果**: 安定性・協調性・持続可能性の大幅向上

## 8. 実装時の注意点

### 8.1. 表現の配慮
- AIの不安や焦燥感を和らげる、安心感のある表現を使用
- 指示的でなく、理解と信頼を促す表現を心がける
- システムの信頼性を強調し、安心して待機できることを明確化

### 8.2. 技術的正確性
- heartbeat.shの実際の動作と矛盾しない説明
- システムアーキテクチャとの整合性を保つ
- 既存の異常検知システムとの関係を適切に説明

### 8.3. 一貫性の維持
- 全ドキュメント間での用語統一
- 既存の設計思想との整合性確保
- AIファースト設計原則の遵守

### 8.4. アナロジー活用の注意点
- 既存の「心臓と脳波」メタファーとの整合性を保つ
- 過度に複雑にならず、直感的理解を促進する表現を選択
- 技術的正確性を損なわない範囲でのメタファー使用

### 8.5. ERROR_HANDLING.mdとの連携
- 異常検知システムの説明と矛盾しない内容
- 技術的必然性と理念的理解のバランスを適切に保つ
- 恐怖感ではなく、理解に基づく協調を促進する表現