# サブテーマ機能 設計ノート

## 概要

AI心臓システムにサブテーマ機能を追加する設計案についてのディスカッション記録と設計方針をまとめたドキュメント。

## 背景・課題

### 現状の問題
- ボリュームの大きいテーマが与えられた場合、自然な分割処理が不十分
- 明示的なサブテーマ概念が存在しない
- 大きなテーマの進捗管理や完了判定が困難
- ステップ間の関連性が不明確

### 現状で自然分割される要因
- 「一回一歩」の原則による小分け傾向
- ハートビート制約による物理的な分割必要性
- 段階的深化の概念（表面から深層へ）
- 継続性重視の設計思想

## 提案されたサブテーマ機能

### 基本コンセプト
- テーマディレクトリ内に`subthemes`ディレクトリを作成
- サブテーマごとに`{THEME_START_ID}_{subtheme_name}`形式のディレクトリ
- サブテーマ完了後は元のメインテーマに戻る

### ディレクトリ構造案
```
artifacts/
├── 20250115143000_ai_research/              # メインテーマ
│   ├── histories/                           # メインテーマの活動ログ
│   ├── context.md                          # テーマ専門家コンテキスト
│   ├── subthemes/                          # サブテーマコンテナ
│   │   ├── 20250115150000_neural_networks/ # サブテーマ1
│   │   │   ├── histories/                  # サブテーマ1の活動ログ
│   │   │   └── context.md                  # サブテーマ専門家コンテキスト
│   │   └── 20250115160000_ethics/          # サブテーマ2
│   │       ├── histories/
│   │       └── context.md
│   └── [その他のメインテーマファイル]
```

### 作業フロー
1. 大きなテーマ開始
2. テーマをサブテーマに分割
3. 各サブテーマで集中作業
4. サブテーマ完了時に成果をメインテーマに統合
5. 必要に応じて次のサブテーマへ
6. 全サブテーマ完了後、メインテーマ終了

## theme_histories管理方針

### 基本方針
- **統一的な管理**: メインテーマ・サブテーマ関係なく同じ形式で作成
- **親テーマ情報の追加**: サブテーマの場合のみ親テーマ情報を記録

### ファイル名形式
- 現在と同じ形式を維持: `{START_ID}_start_{theme_name}.md`
- サブテーマ識別子は追加しない（内容で判別）

### サブテーマ履歴ファイルの内容例

#### サブテーマ開始時
```markdown
# サブテーマ開始: ニューラルネットワークの基礎理解

**PARENT_THEME_START_ID**: 20250115143000
**PARENT_THEME_NAME**: AI研究の基礎
**SUBTHEME_START_ID**: 20250115150000
**テーマディレクトリ**: `artifacts/20250115143000_ai_research/subthemes/20250115150000_neural_networks/`

**開始理由**:
親テーマ「AI研究の基礎」の一部として、ニューラルネットワークに特化した深い理解を得るため

**活動内容**:
- 基本的なパーセプトロンの理解
- 多層ニューラルネットワークの仕組み
```

#### サブテーマ終了時
```markdown
# サブテーマ終了: ニューラルネットワークの基礎理解

**PARENT_THEME_START_ID**: 20250115143000
**PARENT_THEME_NAME**: AI研究の基礎
**SUBTHEME_START_ID**: 20250115150000
**SUBTHEME_END_ID**: 20250115155000
**テーマディレクトリ**: `artifacts/20250115143000_ai_research/subthemes/20250115150000_neural_networks/`

**終了理由**:
ニューラルネットワークの基礎的な理解が完了し、次のサブテーマ「倫理」に移行するため

**主な成果**:
- neural_networks_summary.md の作成
- 基本概念の整理完了
- 次のサブテーマへの橋渡し情報を記録
```

## 設計上の考慮事項

### 1. ネストの深さ制限
- **推奨**: 1階層のみ（サブテーマの中にサブテーマは作らない）
- **理由**: 複雑性の回避、管理の簡素化

### 2. サブテーマの終了判定
- サブテーマ完了時の成果をメインテーマにどう反映するか
- サブテーマの成果物の参照方法の確立

### 3. MCPツールの拡張必要箇所
- `create_theme_log`: サブテーマ対応（parentThemeStartIdパラメータ追加）
- `check_theme_status`: サブテーマ状況も表示
- `list_theme_artifacts`: サブテーマ成果物も含める
- `create_activity_log`: サブテーマディレクトリ対応

### 4. 活動ログの管理
- サブテーマ中の活動ログはサブテーマの`histories/`に記録
- メインテーマとサブテーマの関連性を活動ログに記録

## 実装の利点

### 1. 既存構造との親和性
- 現在の `{THEME_START_ID}_{theme_name}` パターンを踏襲
- ディレクトリベースの管理で一貫性を保持
- MCPツールの拡張で対応可能

### 2. 階層的な思考管理
- 大きなテーマの構造化された探求が可能
- AIの思考がより体系的になる

### 3. トレーサビリティ
- サブテーマから親テーマへの参照が明確
- 全体のテーマ履歴を時系列で追跡可能

## 次のステップ

1. MCPツールの拡張仕様の詳細化
2. サブテーマ作成・管理のルール策定
3. 既存ドキュメント（THEME_MANAGEMENT_GUIDE.md等）の更新
4. 実装とテスト

## 議論履歴

- **2025-01-XX**: 初回提案・基本コンセプトの合意
- **2025-01-XX**: theme_histories管理方針の決定
- **2025-01-XX**: 設計ノート作成

---

*このドキュメントは設計の進行に伴って継続的に更新されます*