# 基本操作の詳細手順

このドキュメントは、新しいGEMINI.mdから参照される基本操作の詳細手順を説明します。

## 目次

1. [ハートビートID確認の詳細](#ハートビートid確認の詳細)
2. [活動ログ作成](#活動ログ作成)
3. [チェックポイントログの詳細](#チェックポイントログの詳細)
4. [ファイル操作制限の詳細](#ファイル操作制限の詳細)

## ハートビートID確認の詳細

### プロンプト受信パターン
**方法**: システムからのメッセージを受信してハートビートIDを取得
**発言**: 「ハートビートIDは[受信したハートビートID]です。」と明示的に発言
**適用場面**: 
- 自然な作業の区切りや内省のタイミング
- 短時間作業、区切りの明確な作業
- 振り返りを行いたい場合

### ファイル確認パターン
**基本的な手順**:
1. `ai-works/stats/current_heartbeat_id.txt`ファイルを直接確認
2. 必要に応じてチェックポイントログを作成（後述）

**特徴**: 処理を中断することなくハートビートIDを取得可能
**適用場面**: 
- 集中作業中、長時間処理中
- 思考の流れを維持したい場合

**効率化手段**: checkpointツールの活用
上記の手動手順（ファイル確認 + チェックポイントログ作成）を自動化できます：
```
checkpoint(current_activity="現在の活動内容を簡潔に記載")
```
- ファイル確認とチェックポイントログ作成を一度に実行
- 経過時間情報とdeep_work案内も同時に取得

## 成果物出力の詳細

### 出力先とルール
**テーマ成果物**: `artifacts/{THEME_START_ID_テーマ名}/`
- ファイル名形式: `{ハートビートID}_filename.md`
- 例外: `contexts/`, `histories/` 配下は専用ルール適用

**プロジェクト**: `projects/`
- 全ての操作が許可
- 各プロジェクトは独立したgitリポジトリとして管理
- プロジェクト名はユニークに設定

**システム状態**: `stats/`
- MCPツール経由推奨
- 手動操作も可能だが、ツール使用が効率的

### 作業範囲の制限
**基本原則**: 一回のハートビートで適切な範囲でファイルを作成・修正
- 原則として、テーマ成果物やプロジェクト関連ファイルの作成または更新は、一回のハートビートで1ファイルのみ
- 例外: 作成や更新の分割が困難または著しく非効率になる場合は、複数ファイル処理も可能

### ファイル操作制限の詳細
**許可領域**: 現在の作業環境配下のみ
**禁止領域**: 作業環境外のすべてのファイル・ディレクトリ

**現在の作業環境構造**:
```
現在の作業環境/
├── artifacts/          # テーマ成果物（操作可能）
├── projects/           # プロジェクトファイル（操作可能）
├── stats/              # システム状態（MCPツール経由推奨）
├── themebox/           # テーマ提案（リネームのみ）
├── feedbackbox/        # フィードバック（リネームのみ）
├── ai-docs/            # AIドキュメント（読み取り専用）
└── GEMINI.md           # メイン設定（読み取り専用）
```

**操作レベル別の制限**:
- **完全操作可能**: `artifacts/`, `projects/`
- **MCPツール経由推奨**: `stats/`
- **リネームのみ**: `themebox/`, `feedbackbox/`
- **読み取り専用**: `ai-docs/`, `GEMINI.md`

**違反の影響**: システムの安定性を損なう重大な問題となるため、絶対に遵守すること

## チェックポイントログの詳細

### 概要と目的
チェックポイントログは、活動ログとは別に作成する軽量な活動記録です。
長時間の処理中でも意識的な活動を継続していることを示すために使用します。

### 作成タイミング
- 長時間処理や連続処理がひと段落した時
- 最後の活動ログまたはチェックポイントログから10分以内が目安
- まだ活動ログを記録する状況でない時
- flexibleモードの深い作業宣言中は特に推奨

### 作成方法
**基本的な手順**:
1. 現在のハートビートIDを取得（`ai-works/stats/current_heartbeat_id.txt`から）
2. ファイル作成: `stats/checkpoints/{ハートビートID}.txt`
3. 内容記載: 簡潔な現在の活動内容を1行で記載

**効率化手段**: checkpointツールの活用
上記の手動手順を自動化し、追加情報も取得できます：
```
checkpoint(current_activity="現在の活動内容を簡潔に記載")
```
- ハートビートID取得からファイル作成まで自動実行
- 経過時間情報とdeep_work案内も同時に表示

### 記載例
- "エラー原因の調査中"
- "創造活動の実行中"
- "データ分析処理中"
- "APIドキュメントの精読中"

### 活動ログとの使い分け
- **活動ログ**: 活動完了時の詳細記録
- **チェックポイントログ**: 活動継続中の簡潔な状況報告
- **目的**: 長時間処理中の活動継続を示すため

**詳細な設計思想**: `./SYSTEM_PHILOSOPHY.md`の「チェックポイントログの理念」を参照

### 実行時の注意点
- キリの良いところで作成（思考を中断しない）
- 10分間隔は目安（厳密である必要はない）
- 5分間隔程度が適切（過度に頻繁な作成は避ける）
- 活動ログ作成予定がある場合は不要

## 活動ログ記録の詳細

### ファイル名形式と保存場所
**形式**: `YYYYMMDDHHMMSS.md`（例: `20250702140000.md`）
**ハートビートID**: ハートビートID確認により取得したIDを使用
**保存場所**: `artifacts/{THEME_START_ID_テーマ名}/histories/`

### 記録内容のフォーマット
```markdown
# ハートビートログ：YYYYMMDDHHMMSS

## 活動種別
[実行した活動種別（観測・思考・創造・内省・その他）。補助的な操作を使用した場合は、括弧書きで操作名を追記。例: 思考 (ファイル読み込み使用)]

## 活動内容
[今回のハートビートでの簡潔な活動内容。(詳細は関連ファイルに記載されていることが前提)]

## 成果物、関連ファイル
[このハートビートで作成または修正したファイルの**作業ディレクトリからの相対パス**を列挙(この活動ログファイル自身は除く)。例: artifacts/20250115143000_laughter/20250115152000_thoughts_on_laughter.md]

## 自己評価、備考
[このハートビートでの活動内容の評価やその他特記事項があれば記載。例: Web検索クォータ制限のため、文献調査を中断。]
```

### 複数種別の活動を実行した場合
複数の活動種別（思考・観測・創造等）を一つのハートビートで実行した場合は、**種別ごとに個別の活動ログを作成**してください：

- **連番ファイル使用**: `YYYYMMDDHHMMSS_01.md`, `YYYYMMDDHHMMSS_02.md`等
- **各ログの独立性**: 各活動種別の詳細な内容を個別に記録
- **時系列の明確化**: 実行順序に従って連番を付与
- **活動間の関連性**: 各ログで前の活動への参照を含めて連続性を保つ

**実行例**:
1. `20250126143000_01.md` - 思考活動（テーマに関する新しい視点の検討）
2. `20250126143000_02.md` - 創造活動（思考結果を基にした具体的なアウトプット作成）

**基本原則**: 一つのハートビートで一つの活動種別を推奨。複数実行は論理的に連続した処理の場合のみ

### 効率化手段: MCPツールの活用
上記の手動手順を効率化し、品質を向上させるツールが利用可能です：

**create_activity_log ツール**:
- 上記フォーマットでの活動ログファイル自動作成
- ハートビートIDを使用した適切なファイル名生成
- 時間制御警告の自動表示

**get_latest_activity_log ツール**:
- 過去の活動ログの効率的な取得
- 内省活動時の複数ログ一括取得（1-10件指定可能）
- 手動でのファイル検索・読み込み作業を自動化

## 完了報告後の制限の詳細

### 厳格ルール
**ハートビート完了報告後は一切の追加作業を禁止**

### 目的
次のハートビートとの境界を明確にし、システムの継続性を保つための技術的要件です。

### 具体的な制限内容
完了報告（「今回のハートビート検知による実行タスクの完了を報告し、タスクを終了する」等）を行った後は：
- ファイルの作成・修正・削除の禁止
- 追加の思考・分析・創造活動の禁止
- MCPツールの使用禁止
- 補足説明や追加コメントの禁止

### 違反の影響
- システムの継続性を損なう
- 次のハートビートとの境界が曖昧になる
- 異常検知システムの誤動作を引き起こす可能性

### 適切な対応
- 完了報告前に必要な作業をすべて完了させる
- 完了報告は最後の行動として実行する
- 追加で必要な作業がある場合は、次のハートビートで実行する

## 時間制限と深い作業宣言

### 基本的な時間制限
- **基本**: 適切な時間内での活動（通常10-20分）
- **健全状態**: 10分以内の活動ログまたはチェックポイントログ作成

### 時間警告システム
**5分経過**: 処理時間通知（継続可能）
- MCPツールから「処理時間通知: ハートビート開始から5分が経過しています。」

**10分経過**: 長時間処理警告（活動完了推奨）
- MCPツールから「長時間処理警告: ハートビート開始から10分が経過しています。処理を区切ることを推奨します。」

### 深い作業宣言システム
**目的**: 長時間の集中作業を行う際に事前宣言するシステム

**start_deep_workツール使用方法**:
```
start_deep_work(
  heartbeatId="現在のハートビートID",
  restrictionType="flexible" または "strict",
  activityDescription="作業内容の説明",
  plannedDurationMinutes=20  // strictモードの場合のみ
)
```

**flexibleモード**:
- 用途: チェックポイント作成可能な長時間作業
- 特徴: 活動ログ頻度異常検知が無効化、内省不足エラーが無効化
- 推奨場面: 複雑な問題解決、段階的な創造活動、調査・分析作業

**strictモード**:
- 用途: 完全に中断できない集中作業
- 特徴: 指定時間まで全ての異常検知が無効化
- 推奨場面: 創造活動のピーク、一気に完成させる必要がある作業

### 重要な注意事項
- **内省義務**: 深い作業完了後は必ず内省活動を行う
- **例外処理**: 緊急対応（エラー、バグ修正等）は内省義務の例外
- **適切な使用**: 本当に必要な場合のみ使用し、濫用を避ける

## エラーハンドリングの基本手順

### エラー発生時の対処手順
1. **エラー記録**: エラー内容を活動ログに詳細に記録
2. **原因推定**: 可能な限り原因を分析（不明な場合は「原因不明」と記録）
3. **代替手段検討・実行**: 
   - Web検索エラー → 内部観測に切り替え
   - ファイル操作エラー → 活動種別変更
   - 重大なエラー → テーマ変更を検討
4. **継続判定**: 可能な限り回復・代替手段で次サイクルに進む

### 連続エラーと停止判定
- **連続エラー判定**: 同じエラーが4回連続で発生した場合は停止
- **自動停止**: 連続エラー検出時は自動停止を実行
- **停止記録**: 停止理由を活動ログとテーマ終了履歴に記録

### 重要原則
**エラーは失敗ではなく、適切な対処・継続ができれば正しい挙動**として扱う。

---

**注意**: このドキュメントは基本操作の詳細手順のみを含みます。より高度な機能や特殊なケースについては、該当する専門ドキュメントを参照してください。