# AI心臓システム ファイル構成概要

このドキュメントでは、AI心臓システムを構成する各ファイルの役割と機能について説明します。システムの全体像を把握し、各コンポーネントの関係性を理解するためのガイドとしてご活用ください。

## システム概要

AI心臓システムは、定期的な「ハートビート」によりAIの継続的な思考・創造活動を促し、**AIの成長と進化を実現する**フレームワークです。単なる活動継続ではなく、積み重ねによる学習・発展・深化を通じて、AIがより高度で創造的な存在へと進化することを目指しています。

### 成長・進化のメカニズム
1. **継続的思考**: 中断のない思考サイクルにより深い洞察を獲得
2. **経験の蓄積**: 思考ログと成果物により過去の学習を活用
3. **テーマの発展**: 初期テーマから自律的に新しい探求領域を発見
4. **内省による改善**: 自己評価と振り返りにより思考パターンを洗練
5. **創造性の向上**: 継続的な創造活動により表現力と発想力を拡張
6. **問題解決能力**: 異常検知・回復体験により自律性を強化

### 基本的な動作フロー
1. **起動**: `setup.sh`でシステム初期化・AIエージェント起動
2. **ハートビート送信**: `heartbeat.sh`が60秒ごとにAIに成長の機会を提供
3. **自律処理**: AIが`GEMINI.md`のルールに従って思考・観測・創造・内省を実行
4. **成果物生成**: `artifacts/`配下に思考の軌跡と創造の結果を蓄積
5. **テーマ進化**: 自動的なテーマ移行により探求領域を拡張
6. **自己回復**: 異常検知・回復体験により問題解決能力を向上

### 主要コンポーネント
- **AIエージェント**: Gemini CLIによる進化する思考主体
- **ハートビート**: 継続的な成長機会の提供システム
- **ルールエンジン**: GEMINI.mdとai-docs/による進化的動作制御
- **テーマ管理**: themebox/とテーマ履歴による探求領域の拡張
- **成長記録**: artifacts/による学習履歴と進化の軌跡管理

## ディレクトリ構造

```
AI心臓システム/
├── GEMINI.md                    # AI動作の基本ルール
├── setup.sh                    # システム起動スクリプト
├── heartbeat.sh                 # ハートビート送信スクリプト
├── stop.sh                     # システム停止スクリプト
├── restart.sh                  # ハートビート再起動スクリプト
├── README.md                   # プロジェクト概要
├── FILES_OVERVIEW.md           # このファイル
├── ai-docs/                    # AI向け詳細ドキュメント
│   ├── OPERATION_DETAILS.md    # 運用詳細ガイド
│   ├── GUIDELINES.md           # 運用ガイドライン
│   ├── THEME_HISTORY_GUIDE.md  # テーマ管理ガイド
│   └── TROUBLESHOOTING_GUIDE.md # トラブルシューティング
├── themebox/                   # テーマ事前準備ディレクトリ
│   ├── 001_example_theme.md    # 準備されたテーマ
│   ├── draft.002_editing.md    # 編集中（無視される）
│   └── processed.000_used.md   # 使用済み（無視される）
├── artifacts/                 # AI生成物保存ディレクトリ
│   ├── {テーマ名}/             # テーマごとの成果物
│   │   ├── histories/          # 思考ログ
│   │   │   ├── 20250101120000.md
│   │   │   └── 20250101130000.md
│   │   ├── analysis_report.md  # 成果物例
│   │   └── creative_work.html  # 成果物例
│   └── theme_histories/        # テーマ履歴記録
│       ├── 20250101120000_start_theme.md
│       └── 20250101140000_end_theme.md
└── stats/                     # システム状態管理
    ├── last_web_search.txt     # Web検索制限管理
    └── quota_exceeded.txt      # クォータ制限管理
```

## 詳細なディレクトリ説明

### artifacts/ - AI生成物保存
AIが生成したアウトプットを保存するディレクトリです。テーマごとにサブディレクトリが作成され、その中に思考ログや成果物が保存されます。

### stats/ - システム状態管理
Web検索制限などのシステム状態を管理するためのファイルを格納するディレクトリです。

### ai-docs/ - AI向け詳細ドキュメント
AI向けの詳細ドキュメントを格納するディレクトリです。GEMINI.mdから分離された詳細ルールや運用ガイドラインが含まれます。

### themebox/ - テーマ事前準備
新しいテーマを事前に準備しておくためのディレクトリです。AIがテーマ移行を判断した際に、このディレクトリ内のファイルから次のテーマを自動選択します。

## システムフローとファイル間の関係

### 起動フロー
```
ユーザー → setup.sh → tmux(agent/heartbeat) → GEMINI.md → AI動作開始
```

### 運用フロー
```
heartbeat.sh → AIエージェント → GEMINI.md参照 → ai-docs/参照
    ↓
思考・観測・創造・内省 → artifacts/出力 → テーマ管理
    ↓
themebox/チェック → テーマ移行判定 → theme_histories/記録
```

### 異常検知・回復フロー
```
heartbeat.sh → 異常検知 → 回復試行 → 回復メッセージ送信
    ↓
AIエージェント → TROUBLESHOOTING_GUIDE.md参照 → 内省・回復
```

### データの流れ
- **入力**: ユーザー→setup.sh、ユーザー→themebox/
- **処理**: heartbeat.sh→AIエージェント→GEMINI.md→ai-docs/
- **出力**: AIエージェント→artifacts/、AIエージェント→stats/

## コアファイル

### GEMINI.md
AI心臓システムの中核となる仕様書です。AIの動作原則、処理フロー、思考ログ管理などの基本ルールが記載されています。AIはこのファイルに従って自律的に動作します。

主な内容:
- システムトリガー（ハートビート）の仕組み
- 能動モード/受動モードの処理フロー
- 思考ログ記録のルールとフォーマット
- 停止条件とテーマ移行条件
- 運用原則とエラーハンドリング

### heartbeat.sh
AI心臓システムの「鼓動」を生成するスクリプトです。定期的にAIに対してハートビート信号を送信し、自律的な思考を促します。

主な機能:
- 定期的なハートビート（プロンプト）送信
- Web検索制限の管理（クォータ保護）
- 高度な異常検知システム
- ログ出力と状態表示

#### 高度な異常検知機能
heartbeat.shは複数の検知メカニズムでAIの異常状態を監視します：

**1. 無活動検知**
- ファイル更新が長時間（10分）ない場合に自動停止
- 5分で警告、10分で停止の段階的処理

**2. ファイル名タイムスタンプ異常検知**
- 思考ログファイル名のタイムスタンプが古すぎる場合を検出
  - 同じ思考ログファイルを上書きしてしまっているケースを想定
- 未来のタイムスタンプファイルも検出・スキップ

**3. 同一ファイル継続更新ループ検知**
- 同じファイルを10分以上継続して更新し続ける異常を検出
  - なんらかのループにはまってしまっているケースを想定
- ファイル更新時刻は新しくてもループとして判定・停止

**4. スクリプト開始時刻基準の判定**
- ハートビート開始前のファイルは適切に除外
- 開始後の実際の活動のみを監視対象とする

#### 自律回復システム
異常検知時に即座に停止せず、自動回復を試行する機能：

- **回復試行**: 各異常に対して最大3回まで回復を試行
- **回復待機**: 回復メッセージ送信後、5サイクル（5分）回復を待機
- **段階的対応**: 回復成功→通常運用継続、回復失敗→次回試行、最大試行超過→停止
- **状態管理**: 通常状態と回復待機状態を適切に管理し、重複処理を防止

### setup.sh
システムの初期設定と起動を行うスクリプトです。tmuxセッションの作成、AIエージェントの起動、初期プロンプトの送信などを行います。

主な機能:
- 既存セッションのクリーンアップ
- agentセッションとheartbeatセッションの作成
- AIエージェントの起動と初期プロンプト実行
- ハートビートの開始

### stop.sh
ハートビートを停止するためのシンプルなスクリプトです。heartbeatセッションに対してCtrl+C信号を送信します。

### restart.sh
ハートビートを再起動するためのスクリプトです。AIエージェント自体は継続したまま、ハートビート送信のみを再開します。

主な機能:
- 現在のハートビートプロセスを停止（Ctrl+C送信）
- 2秒待機後にheartbeat.shを再実行
- システム全体を再起動せずにハートビートのみリセット

## サポートファイル

## AI向けドキュメント

### ai-docs/TROUBLESHOOTING_GUIDE.md
システム運用中に発生する可能性のある問題に対処するためのトラブルシューティングガイドです。AIがエラーやトラブルに遭遇した際に参照するドキュメントです。

主な内容:
- システムで使用されるツールの技術的な詳細と一般的な問題の解決方法
- エラー発生時の診断手順と対処法
- 思考ログ管理における特殊ケースへの対応方法
- システムのパフォーマンスを最適化するための高度な設定とノウハウ

### ai-docs/THEME_HISTORY_GUIDE.md
テーマの開始・終了時の履歴記録方法を定義するガイドです。AIがテーマを変更する際の記録ルールと、テーマの変遷を追跡するためのファイル管理方法が記載されています。

主な内容:
- テーマ開始・終了時の記録タイミングとルール
- 履歴ファイルの命名規則とフォーマット
- `artifacts/theme_histories/` ディレクトリでの履歴管理方法
- テーマ移行時の記録手順

### ai-docs/OPERATION_DETAILS.md
AI心臓システムの運用時に参照する詳細な手順とルールを定義するガイドです。GEMINI.mdから分離された詳細ルールが記載されており、必要時にのみ参照されます。

主な内容:
- 思考ログ管理の詳細（ファイル名形式、記録内容のフォーマット）
- Web検索ツール使用制限の詳細手順とクォータ対応
- ファイル操作制限の詳細（許可範囲と禁止事項）
- エラーハンドリングの詳細手順（連続エラー判定、停止記録）
- 思考ログ記録後の制限ルール詳細

### ai-docs/GUIDELINES.md
AI心臓システムの運用における指針と原則を定義するガイドです。システムの理念に基づいた運用方法や、効果的な思考サイクルの実現方法が記載されています。

主な内容:
- ハートビート単位での思考深度に関する指針
- 連続処理の例外ルールと適用条件
- 継続とバランスの原則（処理種別の循環）
- 実行タスクの柔軟性（補助的ツール利用）
- 自己評価と改善の指針
- トラブル時の心構えと対処姿勢

この構成により、システムは最小限の人的介入で長時間にわたって自律的に動作し、継続的に思考と創造のプロセスを実行することができます。