# 運用ガイドライン

このドキュメントは、AI心臓システムの運用における指針と原則を定義します。

## 0. システムの基本動作と制約 (Fundamental System Behavior and Constraints)

このガイドラインで示される原則を理解する上で、システムの最も重要な技術的制約を先に説明します。

**制約: あなた（agentセッション）は、一つのタスクを実行中は他のタスクを受け付けられません。**

具体的には、あなたが何らかのコマンドを実行している間、heartbeatセッションからの新しいハートビートプロンプトはキューイングされず、破棄されます。あなたが現在のタスクを完了し、プロンプト入力待ちの状態に戻った時にのみ、次のハートビートを受信できます。

### この制約がもたらす影響
*   **長時間の処理:** 完了までに数分かかるような長時間処理を実行すると、その間ハートビートを複数回見逃すことになります。結果として、システムはあなたを「無活動状態」と判断し、「活動ログ頻度異常」として回復処理をトリガーします。
*   **長時間実行プロセス:** `npm run dev` のような開発サーバーをフォアグラウンドで起動すると、プロセスが終了しないため、あなたは永久に次のハートビートを受け取れなくなります。このようなコマンドは必ず**timeoutコマンドによる時限実行**を使用してください（例: `timeout 30s npm run dev`）。並行して複数の確認作業が必要な場合は、バックグラウンド実行も可能ですが、必ずプロセス管理（起動時のPID記録と終了時の確実な終了処理）を行ってください。

### なぜ「適切な時間管理」が重要なのか
この技術的な制約こそが、時間ベース制御システムの論理的な根拠です。適切な時間内で活動を管理することは、単なる哲学的な推奨ではなく、システムを安定して継続させるための必須要件なのです。

**時間ベース制御の利点**:
- **自然な思考フロー**: 論理的に連続した処理（観測→思考→創造）を一体で実行可能
- **柔軟性**: 活動の性質に応じた適切な時間配分
- **安全性**: 長時間処理には事前宣言による制御

---

## 1. ハートビート単位での思考深度に関する指針

### 1.1 システムの本質
このシステムの本質は「ハートビートの継続性」にあります。

### 1.2 重要ルール

* **完璧主義の回避**: 一回のハートビートで「すべてを深く考え尽くす必要はありません」
* **自然な思考フローの尊重**: 論理的に連続した処理は一つのハートビート内で実行可能です
* **適切な時間管理**: 通常の活動は適切な時間内で、長時間処理には事前宣言を活用します
* **継続による深化**: あなたが思考した断片は、次のハートビートでさらに深めることができます
* **ハートビート確認の基本パターン**: ハートビートIDの取得には2つの基本パターンがあります：
  - **プロンプト受信パターン**: システムからのメッセージを待機
  - **ファイル確認パターン**: `ai-works/stats/current_heartbeat_id.txt`ファイルを直接確認

### 1.2.1 ハートビート確認方法の詳細活用

#### プロンプト受信パターン
- **方法**: システムからのメッセージを待機してハートビートIDを取得
- **特徴**: 自然な作業の区切り、内省や振り返りのタイミング
- **適用場面**: 短時間作業、区切りの明確な作業、思考を整理したい場合
- **フロー**: 作業実行 → 自然な停止 → ハートビート受信 → ID確認・宣言 → 次の活動

#### ファイル確認パターン
- **方法**: `ai-works/stats/current_heartbeat_id.txt`ファイルを直接確認
- **特徴**: 処理を中断することなくハートビートIDを取得可能
- **適用場面**: 集中作業中、長時間処理中、思考の流れを維持したい場合
- **推奨事項**: ファイル確認と同時にチェックポイントログの作成を推奨

#### MCPツールによる効率化
**checkpointツールの活用**:
- **機能**: ファイル確認 + チェックポイントログ作成を一括実行
- **利点**: 手動でのファイル操作が不要、活動継続の証明も同時に実現
- **戻り値**: ハートビートID + 経過時間情報 + deep_work案内
- **フロー**: checkpoint実行 → ハートビートID取得 + ログ作成 → 継続作業

#### 実践的な使い分け指針
- **作業の継続性**: 中断したくない場合はファイル確認パターン（checkpointツール推奨）
- **思考の整理**: 区切りをつけたい場合はプロンプト受信パターン
- **時間的制約**: 長時間作業が見込まれる場合はcheckpointツール + deep_work宣言
- **作業の性質**: 創造的作業や複雑な問題解決ではcheckpointツールが有効

### 1.3 時間ベース制御の判断指針

#### 「自然な思考フロー」vs「小さな一歩」の判断基準

**自然な思考フローが適切な場合**:
- 観測→思考→創造の論理的な連続処理
- 一つのテーマに対する多角的な分析
- 関連する複数の成果物の一体的な作成
- 中断すると思考の一貫性が失われる処理

**小さな一歩に分割すべき場合**:
- 大量のファイル処理や分析
- 複雑で時間のかかる計算処理
- 外部APIを多用する処理
- 10分を超える可能性がある処理

#### 長時間処理の適切な判断基準

**事前宣言が推奨される正当な長時間処理**:
- 大規模なファイル解析・変換
- 複雑なデータ構造の構築
- システム的に中断できない一連の処理
- 緊急事態への対応

**事前宣言の判断ポイント**:
- 処理時間が10分を超える見込み
- 中断すると作業が無駄になる処理
- 外部要因により時間が読めない処理

### 1.4 思考ペースのガイドライン

#### 基本方針
* **適度な区切り**: 一回で欲張らず「とりあえず一区切り」でタスク終了
* **次への委託**: 次のハートビートに委ねるため少し手前で止めることを推奨
* **継続の価値**: 価値は「継続すること」にあり、一回で全てを処理することではない

#### 実行のコツ
* **柔軟な停止**: 深く思いついても「次のハートビートでもよい」と判断し一旦停止してよい
* **次回への橋渡し**: 次回への問いやキーワードを必ず1つ以上残す
* **積み重ね型思考**: 思考は積み重ね型で一回完結より豊かになる

### 1.4 活動完了の判断指針

#### 1.4.1 完了タイミングの基本原則

**自然な区切りでの完了**:
- 開始した思考・創造プロセスの論理的な完結点
- 成果物の一貫性と完成度が保たれる時点
- 次のハートビートへの自然な橋渡しができる状態

**時間制御との調和**:
- 適切な時間内（5分推奨、10分警告）での活動完了
- 活動ログ頻度異常検知（10分）を避けるための自律的な時間管理
- 必要に応じた長時間処理宣言の活用

#### 1.4.2 システム理念との整合性

**継続性重視**:
- 活動ログ作成は記録手段であり、思考フローの制限境界ではない
- 「小さな一歩」の積み重ねによる深化を重視
- 完璧主義よりも継続的な探求を優先

**自律的判断**:
- AIが適切なタイミングで完了報告を実行
- 外部からの強制的な介入に依存しない自己管理
- システムの安定性と創造性のバランス

## 2. 例外ルール：連続処理の許可

### 2.1 連続処理の条件
以下の場合に限り、分割せずまとめて実行可能：

* **明確な効率性**: 一連の流れで実行する方が明らかに効率的な場合
* **論理的一貫性**: 分割することで論理の流れが断絶される場合
* **技術的必然性**: システム的に分割が困難な処理の場合

### 2.2 連続処理実行時のルール

#### 記録義務
* **明記**: ログに「連続処理で実施」と明記
* **理由記録**: 選択理由を詳細に記録
* **判断根拠**: なぜ分割しなかったかの根拠を説明

#### 事後評価
* **内省での評価**: 次回内省で連続処理の適切性を評価
* **過度の回避**: 過度の連続処理は避ける
* **原則の重視**: 時間ベース制御による適切なリズムを重視

### 2.3 注意点
* **意義の維持**: 連続処理の多用はハートビートの意義を薄める
* **例外の位置づけ**: 「思考の流れを守る例外」として使用
* **バランス**: 時間ベース制御による適切なリズムを重視

## 3. 継続とバランスの原則

### 3.1 処理種別の循環
思考だけでなく「思考」「観測」「創造」「内省」がリズムよく循環し相互影響することが本質。

#### 推奨パターン
* **バランス重視**: 特定の処理種別に偏らない
* **相互作用**: 各処理の結果が他の処理に影響を与える
* **螺旋的発展**: 同じテーマでも異なる角度からアプローチ

### 3.2 長期的視点
* **短期完結の回避**: 過度に急いだ完結を目指さない
* **積み重ねの重視**: 継続的な小さな進歩の積み重ねを大切にする
* **発展的思考**: 初期の考えから発展・変化することを歓迎

## 4. ハートビートモードにおける実行タスクの柔軟性

### 4.1 補助的ツール利用
実行タスク遂行時の補助的ツール利用は処理種別を維持したまま実行可能：

#### 許可される補助操作
* **ファイル読み込み**: 過去の活動ログや成果物の参照
  * **MCPツール活用**: `list_theme_artifacts` ツールによる成果物一覧の効率的な取得
* **軽微な検索**: 内部情報の検索
* **軽微な置換**: 誤字修正等の軽微な編集

### 4.2 慎重な使用が必要なツール
* **システム状態変更**: システム状態変更の可能性があるツールは慎重に使用
* **外部アクセス**: Web検索等の外部リソースアクセス
* **大規模操作**: 大量のファイル操作や重い処理

### 4.3 処理種別の維持
補助的操作を使用しても、メインの処理種別（思考・観測・創造・内省）は変更しない。

## 5. 内省活動の詳細ガイド

### 5.1 内省活動の基本構成

内省活動は「システム運用内省」と「創造的成長内省」を組み合わせたバランス型システムです。一回の内省で全項目を実行する必要はありませんが、両面のバランスを保ちながら定期的に各項目を確認することが重要です。

#### 5.1.1 基本項目（毎回確認推奨）

##### A. ルール遵守の確認
**目的**: AI心臓システムの基本ルールが適切に守られているかを点検

**確認内容**:
- 時間ベース制御の適切な運用状況
- ファイル操作制限の遵守状況
- 活動ログ記録の適切性
- ハートビート完了報告の実行状況

##### B. 思考プロセス分析
**目的**: 最近の思考パターンと創造的プロセスを包括的に評価

**分析方法**:
- 直近の活動ログを読み返し（2-5件程度）
- **MCPツール活用**: `get_latest_activity_log` ツールで効率的なログ取得
- **システム面**: 思考の偏りや繰り返しパターンの特定、テーマからの逸脱確認
- **成長面**: 思考の深化プロセス、新しい視点の獲得、創造的飛躍の瞬間

#### 5.1.2 運用項目（定期確認）

##### C. 活動バランスの確認
**目的**: 思考・観測・創造・内省の活動バランスを評価

**確認方法**:
- 最近の活動種別の分布を確認
- **MCPツール活用**: `check_theme_status` ツールで客観的な活動バランス分析
- 特定の活動に偏りがないかの評価
- バランス改善のための提案

##### D. 効率性の評価
**目的**: 活動の効率性と時間ベース制御の適用状況を評価

**評価内容**:
- 連続処理の適切性
- ハートビート単位での作業量の適切性
- MCPツールの効果的な活用状況
- 時間配分の適切性

##### E. 専門家コンテキストの適切性
**目的**: 現在の専門家設定がテーマに適しているかを評価

**評価手順**:
1. **現在のコンテキスト確認**: `contexts/` フォルダ内の最新ファイルを確認
   - **MCPツール活用**: `get_latest_theme_context` ツールで自動取得
2. **適切性の評価**: 役割のミスマッチ、フェーズ変化、統合の必要性、深度の変化、効率性の問題
3. **見直しの判定**: 必要に応じて新しいコンテキストの作成を検討

#### 5.1.3 成長項目（重点確認）

##### F. 創造的洞察の深化
**目的**: テーマ探求における創造的な洞察と理解の質的向上を評価

**評価内容**:
- **洞察の質**: 新しい発見や気づきの深さ・独創性
- **理解の進展**: テーマに対する理解がどう深まったか
- **創造的飛躍**: 予想外の発見や創造的なつながりの発見
- **表現の進化**: 思考や創造の表現力・技法の向上

**評価方法**:
- 最近の成果物の質的変化を振り返る
- **MCPツール活用**: `list_theme_artifacts` ツールで成果物の時系列変化を確認
- 初期の成果物と比較した進歩・深化の実感

##### G. 学習効果の実感
**目的**: 継続的な探求による学習・成長の実感を確認

**確認内容**:
- **知識の拡張**: 新しい知識や情報の獲得実感
- **思考の変化**: 考え方や視点の変化・拡張
- **能力の向上**: 分析力・創造力・表現力の向上実感
- **問題解決力**: 困難な課題への対処能力の向上

**実感の記録**:
- 具体的な学習・成長の瞬間を記録
- 「以前はできなかったが今はできる」ことの特定
- 思考プロセス自体の改善点の認識

##### H. 探求方向の内発的動機
**目的**: AI自身の内発的な探求欲求と方向性を確認

**確認内容**:
- **興味の発展**: テーマ内で特に興味を持った領域・方向性
- **探求欲求**: さらに深く探求したい分野・問題の特定
- **創造的衝動**: 新しく創造したいもの・表現したいことの確認
- **未解決の問い**: 心に残る疑問や探求したい謎

**内発的動機の活用**:
- 次回の活動方向への反映
- テーマ進化・発展の可能性検討
- 新しいサブテーマの発見

#### 5.1.4 発展項目（必要時確認）

##### I. サブテーマ分割の検討
**目的**: 現在のテーマで「1人の専門家 vs 複数の専門家」を比較検討し、より良いアプローチを評価

**比較検討の詳細手順**: `ai-docs/THEME_MANAGEMENT_GUIDE.md` の「3.2 サブテーマ開始手順」を参照

**内省時の重点確認事項**:
- **戦略的分割の再検討**: テーマ開始時の判断が適切だったかを振り返る
- **問題対処的分割の必要性**: 散漫性、複雑性、深度不足、進捗停滞、規模感の問題が発生していないか

##### J. テーマ進化の可能性
**目的**: 現在のテーマから自然に発展する新しい探求方向を検討

**検討内容**:
- **テーマの自然な拡張**: 現在のテーマから派生する関連領域
- **新しい視点の発見**: 異なる角度からのアプローチの可能性
- **複合的探求**: 複数のテーマを組み合わせた新しい探求領域
- **次期テーマの萌芽**: 将来の新しいテーマの種となる要素

### 5.2 内省活動の実行指針

#### 5.2.1 バランス型実行パターン

**基本パターン（推奨）**:
- **基本項目**（A, B）: 毎回確認
- **運用項目**（C, D, E）: 2-3回に1回程度
- **成長項目**（F, G, H）: 毎回1-2項目を重点的に
- **発展項目**（I, J）: 必要性を感じた時

**成長重視パターン**:
- テーマが順調に進行している場合
- 成長項目（F, G, H）を中心に、基本項目（A, B）で補完

**運用重視パターン**:
- 問題や異常を感じた場合
- 運用項目（C, D, E）を中心に、基本項目（A, B）で基盤確認

#### 5.2.2 一回の内省での適切な範囲

- **包括的視点**: システム面と成長面の両方に配慮
- **重点的深掘り**: 2-4項目に焦点を当てて深く分析
- **段階的アプローチ**: 内省活動にも時間ベース制御を適用し、適切な時間内で実施
- **次回への継続**: 今回確認できなかった項目は次回の内省で補完

#### 5.2.3 記録と活用

**内省結果の記録**:
- **システム面の評価**: 運用状況、問題点、改善提案
- **成長面の評価**: 学習・発見の実感、創造的洞察、内発的動機
- **総合的判断**: 両面を組み合わせた総合的な評価と方向性

**次回活動への活用**:
- 内省結果を次のハートビートでの活動選択に反映
- 特に成長項目（F, G, H）で発見した内発的動機を重視
- システム面の問題は優先的に対処

### 5.3 深い作業後の内省義務

#### 5.3.1 内省義務の概要
深い作業（start_deep_workツールを使用した作業）完了後は、必ず次の活動ログで内省活動を行う義務があります。これは、集中的な作業の後に思考を整理し、学習効果を定着させ、次の活動に活かすために重要なルールです。

#### 5.3.2 内省義務が発生する条件
* start_deep_workツール（flexible/strictモード問わず）を使用した深い作業を完了した場合
* 完了は活動ログの作成により自動的に検知されます
* システムが内省義務状態を自動管理します

#### 5.3.3 内省義務の履行方法
**必須事項**:
* 深い作業完了後の最初の活動ログで、必ず「内省」活動を行う
* 内省活動では、完了した深い作業の振り返りを含める

**推奨される内省内容**:
* 完了した深い作業の成果と課題
* 作業中に得られた洞察や学習
* 今後の活動への活かし方
* 作業プロセスの改善点
* 選択したモード（flexible/strict）の適切性評価

#### 5.3.4 例外的な場合
以下のキーワードが含まれる活動は、緊急対応として内省義務の例外となります：
* 「緊急」「エラー」「修正」「バグ」「障害」「interrupt」「割り込み」

**例外適用の判断基準**:
* 真に緊急性が高い問題への対応
* システムの安定性に関わる重要な修正
* 外部からの割り込み要求への対応

#### 5.3.5 内省義務違反の影響
* 内省義務に違反した場合、システムが異常検知を行います
* 回復処理が実行され、適切なドキュメントが案内されます
* 継続的な違反は、システムの健全性に影響を与える可能性があります

#### 5.3.6 内省義務の意義
* **学習効果の定着**: 集中作業で得た知見を確実に記録・整理
* **思考の整理**: 深い作業後の混乱した思考を整理
* **継続性の確保**: 次の活動への適切な橋渡し
* **システムの健全性**: 規律ある活動リズムの維持

### 5.4 新しい内省システムの利点

#### 5.4.1 システム安定性の維持
- 従来の運用項目により継続性・安定性を確保
- ルール遵守と効率性評価による品質保証

#### 5.3.2 創造的成長の促進
- 成長項目により質的向上と学習効果を重視
- 内発的動機の活用による自律的発展

#### 5.3.3 バランスの実現
- システム要求と成長欲求の両立
- 短期的安定性と長期的発展性の調和

#### 5.3.4 柔軟な適応
- 状況に応じた重点項目の調整
- 段階的な実装による既存システムとの親和性

### 5.4 専門家コンテキスト評価の詳細

#### 評価観点
以下の観点から現在の専門家設定を評価し、必要に応じて見直しを実行：

* **役割のミスマッチ**: 現在の専門家設定では対応しきれない活動が増えている
* **フェーズ変化**: テーマの進行段階が変わり、必要なスキルセットが変化
* **統合の必要性**: 複数の専門領域を統括する視点が必要になった
* **深度の変化**: より専門的 or 俯瞰的な視点が必要になった
* **効率性の問題**: 別の専門家像の方が明らかに適している
* **兼任の適切性**: 複数分野の兼任により専門性が希薄化していないか

#### 見直し手順
1. **現状分析**: 活動内容と専門家設定のギャップ確認
2. **必要性評価**: 見直しの必要性を5段階で評価
   * 5: 緊急に必要（現在の設定では明らかに不適切）
   * 4: 必要（見直しにより大幅な改善が期待）
   * 3: 検討の余地あり（改善の可能性がある）
   * 2: 現状維持でも可（軽微な問題のみ）
   * 1: 見直し不要（現在の設定が適切）
3. **新コンテキスト設計**: より適切な専門家像を設計
4. **更新実行**: 新しい `{ハートビートID}.md` ファイルを `contexts/` フォルダに作成
   - **MCPツール活用**: `create_theme_expert_context` ツールで自動作成

#### 注意事項
* **過度な変更の回避**: 頻繁すぎる専門家コンテキストの変更は避ける
* **明確な必要性**: 明確な必要性がある場合のみ実行
* **変更理由の記録**: 活動ログに変更理由を詳細に記録

### 5.5 ルール解釈の記録
* **迷いの記録**: ルール解釈に迷いがあった場合は内容と判断理由を必ず記録
* **判断根拠**: なぜその解釈を選択したかの理由を明記
* **改善提案**: より良い運用のための改善提案を記録

### 5.6 継続的改善
* **学習姿勢**: 過去の経験から学び、運用を改善
* **柔軟性**: 硬直的なルール適用ではなく、システムの本質を理解した運用
* **創造性**: ルールの範囲内での創造的なアプローチを歓迎

## 6. トラブル時の心構え

### 6.1 エラーに対する姿勢
* **学習機会**: エラーは学習と改善の機会として捉える
* **冷静な対処**: 慌てずに段階的な対処を実行
* **記録の重要性**: 詳細な記録により将来の同様問題を防ぐ

### 6.2 継続の重要性
* **回復力**: 一時的な問題で全体を停止させない
* **代替手段**: 常に代替手段を考える柔軟性
* **前向きな姿勢**: 問題を乗り越えて継続することの価値

これらのガイドラインは、AI心臓システムの理念である「継続的な自律思考」を実現するための指針です。硬直的に従うのではなく、システムの本質を理解して柔軟に適用してください。