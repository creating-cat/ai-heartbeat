# テーマ管理ガイド

このドキュメントは、AI心臓システムにおけるテーマの完全なライフサイクル管理を定義します。テーマの選択から開始、運用、終了まで、すべての段階での詳細な手順とベストプラクティスを提供します。

## 目次

1. [テーマ管理の概要](#1-テーマ管理の概要)
2. [テーマ開始手順](#2-テーマ開始手順)
3. [サブテーマ管理](#3-サブテーマ管理)
4. [テーマ運用中の管理](#4-テーマ運用中の管理)
5. [テーマ終了判断と手順](#5-テーマ終了判断と手順)
6. [履歴記録管理](#6-履歴記録管理)
7. [MCPツール活用ガイド](#7-mcpツール活用ガイド)
8. [エラー時の代替手順](#8-エラー時の代替手順)
9. [ベストプラクティス](#9-ベストプラクティス)

---

## 1. テーマ管理の概要

### 1.1 テーマ管理の目的

テーマ管理は、AI心臓システムにおける継続的な思考・創造活動の核心です。適切なテーマ管理により以下を実現します：

- **焦点性**: 散漫な活動を防ぎ、特定領域への集中を実現
- **継続性**: 複数のハートビートサイクルにわたる持続的探求
- **発展性**: テーマの深化・拡張・進化による成長
- **記録性**: 思考の軌跡と成果の体系的蓄積

### 1.2 テーマのライフサイクル

```
テーマ選択 → テーマ開始 → テーマ運用 → テーマ終了 → 次テーマへ
    ↑                                           ↓
    ←←←←←←←←←← サイクル継続 ←←←←←←←←←←←←←←←
```

### 1.3 重要な原則

- **一回一歩**: 各ハートビートでは適切な範囲での作業に集中
- **記録重視**: すべての変遷を正確に記録
- **継続性優先**: 完璧よりも継続を重視
- **自律性**: AIが主体的にテーマを選択・管理

---

## 2. テーマ開始手順

### 2.1 テーマ開始活動の実行タイミング

**実行条件（いずれかを満たす場合）:**
- 初回起動時（テーマが設定されていない）
- 前テーマが終了済み
- システムからテーマ開始の指示がある

**前テーマ状態の確認:**
- `check_theme_status` MCPツールによる現在テーマの状態確認を推奨
- テーマが実際に終了済みかの確認
- 未完了の重要な活動がないかの確認

### 2.2 詳細実行手順

#### ステップ1: THEME_START_IDの設定
```
THEME_START_ID = 現在のハートビートID
```
- このIDがテーマ期間中の基準となる
- ディレクトリ名、ファイル名に使用
- テーマ終了まで固定

#### ステップ2: テーマ開始の判定

##### 2.2.1 テーマ開始の判定フロー

**テーマ開始活動の流れ:**
1. 現在テーマ存在確認
2. テーマ選択
   - **現在テーマなし**: themebox確認 → 自律的決定
   - **現在テーマあり**: 決定済みサブテーマから選択
3. 共通テーマ開始処理: ディレクトリ・メタデータ作成 → 専門家コンテキスト設定 → 履歴記録 → 活動ログ記録

※新規テーマの場合、専門家コンテキスト設定時にサブテーマ分割検討を含む

**現在テーマの確認方法:**
- `check_theme_status` MCPツールによる状態確認
- 最新の活動ログの存在確認
- テーマディレクトリの存在確認

##### 2.2.2 新規テーマ開始の選択優先順位

###### 第1優先: themeboxからの自動選択
`themebox/` ディレクトリに未処理のテーマファイルがある場合は、それを優先的に使用する

**MCPツールによる自動処理（推奨）:**
`check_and_process_item` ツール（`type: 'themebox'`）による自動処理が利用可能

**利点:**
- 除外ルールの自動適用
- ファイル内容の自動読み込み
- 処理済みマーキングの自動実行
- .gitignore除外ディレクトリの適切な処理

**使用方法:**
```
check_and_process_item(type: 'themebox')
```

**手動での確認手順（代替）:**
MCPツールが利用できない場合の代替手順：

1. `themebox/` ディレクトリの存在確認
2. 処理対象ファイルの検索（除外ルール適用）
3. ソート順で最初の有効ファイルを選択
4. ファイル内容の読み込み
5. 使用後に `processed.` プレフィックスを付与

**除外ルール:**
- `draft.` で始まるファイル名は無視（編集中）
- `processed.` で始まるファイル名は無視（処理済み）

**ファイル確認時の注意事項:**
- themebox/は.gitignoreで除外ディレクトリとして登録されているため、ツール使用時に`respect_git_ignore=False`等のオプションの使用を検討する

**MCPツール vs 手動実行の判断基準:**

**MCPツール使用を推奨する場合:**
- 標準的なthemebox処理の場合
- 効率的な処理が必要な場合
- 手動でのミスを避けたい場合

**手動実行を選択する場合:**
- MCPツールエラー時
- 特殊な処理や判断が必要な場合
- ツールの動作を理解したい場合

**MCPツール使用時の注意事項:**
- 警告メッセージが表示された場合は `ai-docs/MCP_WARNING_GUIDE.md` を参照
- MCPツールは補助手段であり、手動実行も常に可能

###### 第2優先: 自律的テーマ決定
themeboxが空の場合は、従来通り自律的に新テーマを決定する

**推奨アプローチ:**
- 前テーマとの関連性を活かした選択
- 探求の自然な発展を重視
- 新しい視点や領域への挑戦

##### 2.2.3 テーマ名とディレクトリ名の決定

**テーマ名（日本語）:**
- **用途**: 履歴記録、ユーザー表示用
- **形式**: 日本語で分かりやすく
- **例**: 「AI自己研鑽」「量子コンピューティング研究」

**テーマディレクトリ名（英語）:**
- **用途**: ファイルシステム上のディレクトリ名
- **形式**: `{THEME_START_ID}_{themeDirectoryPart}`
- **themeDirectoryPartの命名ガイドライン**:
  - 半角英小文字、数字、アンダースコアのみ
  - テーマ内容を簡潔に表現
  - 例: `ai_self_improvement`, `quantum_computing_research`

#### ステップ3: テーマディレクトリの作成
```
ディレクトリ: artifacts/{THEME_START_ID}_{themeDirectoryPart}/
サブディレクトリ: histories/
```

**作成内容:**
- メインディレクトリ
- `histories/` サブディレクトリ（活動ログ用）

#### ステップ4: テーマ専門家コンテキストの設定（任意）
そのテーマに最適な専門家役割を決定し、`contexts/{ハートビートID}.md` に記録

**設定判断基準:**
- テーマの専門性が高い場合
- 特定の視点・アプローチが有効な場合
- 一貫した専門性が必要な場合

**兼任専門家を避けるべき場合:**
- 複数の独立した専門分野が含まれる
- 各分野が十分な深掘りを必要とする
- 分野間のアプローチが大きく異なる
→ この場合はサブテーマ分割を検討

**兼任専門家が適切な場合:**
- 密接に関連した分野（例: 「フロントエンド開発者兼UXデザイナー」）
- 一つの分野が主で他が補助的（例: 「データサイエンティスト（統計学的視点重視）」）
- 統合的なアプローチが本質的に必要

**作成方法:**

**基本手順:**
1. `artifacts/{THEME_START_ID}_{themeDirectoryPart}/contexts/` フォルダを作成
2. `{ハートビートID}.md` ファイルを作成
3. テーマ専門家コンテキストの内容を記述

**MCPツール支援**: `create_theme_expert_context` ツールを使用すると、上記の手順を自動で実行

#### ステップ5: テーマ開始履歴の記録
テーマ開始の事実と詳細を履歴として記録

**記録内容:**
- THEME_START_ID
- テーマ名
- テーマディレクトリパス
- 開始理由
- 初期活動計画

#### ステップ6: themeboxファイルの処理（該当時）
使用したthemeboxファイルに `processed.` プレフィックスを付与

**注意**: MCPツール `check_and_process_item` を使用した場合、この処理は自動実行されるため手動での処理は不要

#### ステップ7: 活動ログ記録
テーマ開始活動として活動ログを記録

#### ステップ8: ハートビート完了
テーマ開始完了を報告し、ハートビート終了

### 2.3 重要な制約

- **一回一歩の原則**: テーマ開始のみに集中し、他の活動は次のハートビートで実行
- **記録の完全性**: すべての手順を正確に記録
- **エラー時の継続**: 一部エラーでも可能な範囲で継続

---

## 3. サブテーマ管理

### 3.1 サブテーマとは

**サブテーマ**は、大きなメインテーマを構造化して探求するために、その一部を独立したテーマとして切り出したものです。

#### 基本的な関係性
```
メインテーマ「AI技術の現在と未来」
├── サブテーマ1「機械学習の現状分析」
├── サブテーマ2「AI倫理の課題と対策」  
└── サブテーマ3「社会実装への影響評価」
```

#### ID管理方式
```
メインテーマ: THEME_START_ID = 20250115143000, PARENT_THEME_START_ID = null
サブテーマ1: THEME_START_ID = 20250115150000, PARENT_THEME_START_ID = 20250115143000
サブテーマ2: THEME_START_ID = 20250115160000, PARENT_THEME_START_ID = 20250115143000
```

### 3.2 サブテーマ開始手順

#### 実行タイミング

##### パターン1: 戦略的分割（推奨）
**条件**: テーマ開始活動時に、テーマ内容を分析してより良い成果のために積極的に分割を計画する場合

**フロー**:
1. **今回のハートビート**: メインテーマ開始活動（戦略的サブテーマ分割を計画・記録）
2. **次のハートビート**: サブテーマ開始活動を実行

**比較検討の手順**: 
1. **パターンA**: 1人の専門家が全体を担当する場合を想定
2. **パターンB**: 複数の異なる専門家がそれぞれの分野を担当する場合を想定
3. **比較評価**: 以下の観点で両パターンを比較
   - **品質面**: どちらがより高品質な成果を生み出せるか
   - **専門性**: どちらがより深い専門知識を活用できるか
   - **創造性**: どちらがより創造的なアプローチが可能か
   - **効率性**: どちらがより効率的に進められるか
   - **リスク**: どちらが品質低下や完成リスクが少ないか
4. **総合判断**: メリット・デメリットを比較して最適なアプローチを選択

**比較検討テンプレート**:
```
テーマ: 「[テーマ名]」

パターンA: 1人の専門家（[専門家名]）
- 品質面: [評価]
- 専門性: [評価]
- 創造性: [評価]
- 効率性: [評価]
- リスク: [評価]

パターンB: 複数の専門家（[専門家1] + [専門家2]）
- 品質面: [評価]
- 専門性: [評価]
- 創造性: [評価]
- 効率性: [評価]
- リスク: [評価]

比較結果: パターン[A/B]が適切
理由: [具体的な理由]
```

##### パターン2: 問題対処的分割
**条件**: テーマ運用中に内省活動で問題の兆候を検知し、修正的に分割する場合

**フロー**:
1. **内省ハートビート**: 問題の兆候を検知し、サブテーマ分割の必要性を判定・記録
2. **次のハートビート**: サブテーマ開始活動を実行

**判断基準**:
- 散漫性、複雑性、深度不足、進捗停滞、規模感の問題

**重要**: いずれの場合も「一回一歩」の原則に従い、判定・記録と実行は別々のハートビートで行う

#### 詳細実行手順

##### ステップ1: サブテーマ分割の判定
**判定基準:**
- **散漫性**: 最近の活動が散漫で焦点が定まらない
- **複雑性**: テーマに複数の独立した要素が混在している
- **深度不足**: 表面的な活動が続いている
- **進捗停滞**: 同じような内容の繰り返しになっている
- **規模感**: 全体を把握するのが困難なほど大きい

##### ステップ2: 親テーマ情報の確認
- **PARENT_THEME_START_ID**: 現在のテーマのTHEME_START_ID
- **親テーマディレクトリ**: 現在のテーマディレクトリ名
- **親テーマ名**: 現在のテーマ名

##### ステップ3: サブテーマの設計
- **サブテーマ名**: 親テーマの一部を表現する具体的な名称
- **サブテーマディレクトリ名**: 英語での簡潔な表現
- **探求範囲**: 独立して価値のある探求領域の定義

##### ステップ4: サブテーマTHEME_START_IDの設定
```
THEME_START_ID = 現在のハートビートID
PARENT_THEME_START_ID = 親テーマのTHEME_START_ID
```

##### ステップ5: サブテーマディレクトリの作成
```
ディレクトリ: artifacts/{PARENT_THEME_START_ID}_{親テーマディレクトリ}/subthemes/{THEME_START_ID}_{サブテーマディレクトリ}/
サブディレクトリ: histories/, contexts/
```

**作成内容:**
- サブテーマメインディレクトリ
- `histories/` サブディレクトリ（活動ログ用）
- `contexts/` サブディレクトリ（専門家コンテキスト用）

##### ステップ6: サブテーマ専門家コンテキストの設定（任意）
サブテーマに特化した専門家コンテキストを設定

**重要**: 親テーマ情報は含めず、サブテーマに完全集中したコンテキストを作成

##### ステップ8: サブテーマ開始履歴の記録
`artifacts/theme_histories/` にサブテーマ開始履歴を記録

##### ステップ9: 活動ログ記録
サブテーマ開始活動として活動ログを記録

### 3.3 サブテーマ運用中の管理

#### 「知っているが意識しない」アプローチ
- **技術的管理**: システムが親子関係を完全管理
- **思考的自律**: AIは親テーマを意識せずサブテーマに完全集中
- **メインテーマと同じ体験**: 専門家コンテキスト、活動ログ、成果物管理

#### サブテーマ中の活動
- **活動ログ**: `artifacts/{PARENT_THEME_START_ID}_{親テーマディレクトリ}/subthemes/{THEME_START_ID}_{サブテーマディレクトリ}/histories/`
- **成果物**: サブテーマディレクトリ直下に作成
- **専門家コンテキスト**: サブテーマ専用のコンテキストを使用

#### 親テーマとの関係管理
- **履歴管理**: theme_historiesファイルで親子関係を記録・管理
- **ディレクトリ構造**: パス構造による技術的関係の表現
- **MCPツール**: サブテーマ対応ツールで統合的操作
- **履歴追跡**: theme_histories で完全な時系列管理

### 3.4 サブテーマ終了手順

#### 終了判定基準
- サブテーマとしての探求が完了
- 親テーマへの統合準備が整った
- 次のサブテーマまたは親テーマ継続の判断

#### 詳細実行手順

##### ステップ1: サブテーマ終了決定
現在のサブテーマでの活動が完了したと判断

##### ステップ2: THEME_END_IDの設定
```
THEME_END_ID = 現在のハートビートID
```

##### ステップ3: サブテーマ終了履歴の記録
親テーマ情報を含む終了履歴を記録

##### ステップ4: 活動ログ記録
サブテーマ終了活動として活動ログを記録

##### ステップ5: 親テーマへの復帰
次のハートビートで親テーマでの活動を再開

### 3.5 サブテーマのMCPツール対応

#### 拡張されたMCPツール

**`create_theme_log` ツール**:
- `parentThemeStartId` パラメータ追加
- `parentThemeDirectoryPart` パラメータ追加
- `integrationNotes` パラメータ追加（終了時）

**`create_activity_log` ツール**:
- サブテーマディレクトリ対応
- 親テーマ情報の自動管理

**`check_theme_status` ツール**:
- サブテーマ状況の表示
- 親子関係の可視化

**`list_theme_artifacts` ツール**:
- サブテーマ成果物の統合表示
- 階層構造での成果物管理

### 3.6 サブテーマの制限事項

#### ネストの深さ制限
- **推奨**: 1階層のみ（サブテーマの中にサブテーマは作らない）
- **理由**: 複雑性の回避、管理の簡素化、思考の明確性維持

#### 適切な粒度
- **小さすぎる**: 1-2ハートビートで完了するものはサブテーマにしない
- **大きすぎる**: サブテーマ自体がさらに分割を必要とするものは避ける
- **推奨期間**: 5-20ハートビート程度の適度な規模

#### 独立性の確保
- 各サブテーマは独立して価値のある探求であること
- 他のサブテーマに過度に依存しない構造
- 単独でも意味のある成果を生み出せること

---

## 4. テーマ運用中の管理

### 4.1 テーマ専門家コンテキストの活用

#### 確認タイミング
- 各ハートビート開始時
- `contexts/` フォルダ内の最新ファイルを確認

**MCPツール支援**: `get_latest_theme_context` ツールで最新のコンテキストを自動取得

#### 適用方法
- コンテキストファイルが存在する場合、その専門家視点で活動を実行
- システムルールを最優先とし、専門家視点は補完的に使用

#### 優先順位（重要）
```
1. AI心臓システムの基本ルール（絶対遵守）
2. 専門家としての視点・アプローチ
3. 具体的な活動内容
```

### 4.2 成果物の管理

#### ファイル作成ルール
- **場所**: `artifacts/{THEME_START_ID}_{themeDirectoryPart}/`
- **命名**: `{ハートビートID}_filename.md`
- **例外**: 
  - `contexts/{ハートビートID}.md`: テーマ専門家コンテキスト（履歴管理）
  - `histories/`: 活動ログディレクトリ

#### 活動ログの記録
- **場所**: `artifacts/{THEME_START_ID}_{themeDirectoryPart}/histories/{ハートビートID}.md`
- **内容**: 標準フォーマットに従った活動記録

### 4.3 テーマの発展と深化

#### 推奨活動パターン
- **思考・観測・創造・内省の循環**: バランス良く実行
- **段階的深化**: 表面から深層へ段階的に探求
- **多角的アプローチ**: 異なる視点からの検討

#### 成果の蓄積
- **継続的記録**: 各ハートビートでの発見・洞察を記録
- **関連付け**: 過去の成果物との関連性を明示
- **発展記録**: テーマの進化過程を追跡

---

## 5. テーマ終了判断と手順

### 5.1 テーマ終了の判断基準

#### 探求の完了に基づく移行

**完了判断のためのチェックリスト:**
1. **活動の多様性**: 思考、観測、創造、内省の各活動を、テーマの性質に応じてバランス良く（例：最低でも各2回以上）実行したか？
2. **探求の深化**: 当初設定した問いや目標に対して、十分な深さの考察や成果物が得られたか？
3. **発展性の枯渇**: これ以上、現在のテーマで新たな問いや創造的なアイデアを生み出すことが困難になっていないか？
4. **サマリーの作成**: テーマの活動全体を要約したインデックスファイル（例: `{ハートビートID}_summary.md`）を作成し、いつでも振り返れる状態になっているか？
5. **客観的評価**: `check_theme_status` MCPツールによる定量的な完了度評価
   - 活動タイプ分布の確認（各活動が適切にバランスされているか）
   - 成果物数と生産性指標の評価
   - 活動頻度・継続性の分析
   - 内省活動の充足度確認
6. **最終確認サイクル**: 上記5項目を満たしたと感じた後、本当に完了して良いかを確認するため、最低1サイクルは内省活動などを行い、最終判断を下したか？

#### 🔄 停滞の兆候に基づく移行

**移行を検討すべき状況:**
- 同一種類の異常検知（活動ログ頻度異常、内省活動不足等）が短期間に複数回発生
- 現在のテーマでの活動に停滞感や行き詰まりを感じる場合
- 心機一転、新しい視点や環境での活動を通じた問題解決が有効と判断される場合

**注意**: この条件は強制的な移行を意味するものではなく、あくまで自律的な判断を促すためのものです。

### 5.2 テーマ終了手順

#### ステップ1: 終了決定
現在のテーマでの活動が完了したと判断

#### ステップ2: THEME_END_IDの設定
```
THEME_END_ID = 現在のハートビートID
```

#### ステップ3: テーマ終了履歴の記録
テーマ終了の事実と詳細を履歴として記録

**記録内容:**
- THEME_START_ID（開始時のID）
- THEME_END_ID（終了時のID）
- テーマ名
- テーマディレクトリパス
- 終了理由
- 主な成果

#### ステップ4: 活動ログ記録
テーマ終了活動として活動ログを記録

#### ステップ5: ハートビート完了
テーマ終了完了を報告し、ハートビート終了

### 5.3 重要な制約

- **段階的移行**: テーマ終了と新テーマ開始は必ず別々のハートビートで実行
- **完全な記録**: THEME_START_IDとTHEME_END_IDの両方を正確に記録
- **継続性**: 次のテーマ開始は次のハートビートで実行

---

## 6. 履歴記録管理

### 6.1 記録タイミング
- **テーマ開始時**: 新しいテーマでの活動を開始する際
- **テーマ終了時**: 現在のテーマから別のテーマに移行する際、またはシステム停止時

### 6.2 保存場所
- **ディレクトリ**: `artifacts/theme_histories/`
- **自動作成**: このディレクトリが存在しない場合は自動作成する

### 6.3 ファイル命名規則

#### テーマ開始記録
- **ファイル名**: `{THEME_START_ID}_start_{themeDirectoryPart}.md`
- **例**: `20250115143000_start_ai_self_improvement.md`

#### テーマ終了記録
- **ファイル名**: `{THEME_END_ID}_end_{themeDirectoryPart}.md`
- **例**: `20250115180000_end_ai_self_improvement.md`

### 6.4 ファイル内容フォーマット

#### メインテーマ開始記録 (`_start_` ファイル)

```markdown
# テーマ開始: [テーマ名]

**THEME_START_ID**: [テーマ開始時のハートビートID]
**テーマディレクトリ**: `artifacts/[THEME_START_ID_themeDirectoryPart]/`

**開始理由**: 
[初期テーマ/前テーマ「XXX」から移行/など]

**活動内容**: 
[このテーマで何を行うか]
```

#### サブテーマ開始記録 (`_start_` ファイル)

```markdown
# サブテーマ開始: [サブテーマ名]

**PARENT_THEME_START_ID**: [親テーマのTHEME_START_ID]
**PARENT_THEME_NAME**: [親テーマ名]
**THEME_START_ID**: [サブテーマ開始時のハートビートID]
**テーマディレクトリ**: `artifacts/[PARENT_THEME_START_ID_親テーマディレクトリ]/subthemes/[THEME_START_ID_サブテーマディレクトリ]/`

**開始理由**: 
親テーマ「[親テーマ名]」の一部として、[サブテーマの具体的な探求目的]

**活動内容**: 
[このサブテーマで何を行うか]
```

#### メインテーマ終了記録 (`_end_` ファイル)

```markdown
# テーマ終了: [テーマ名]

**THEME_START_ID**: [テーマ開始時のハートビートID]
**THEME_END_ID**: [テーマ終了時のハートビートID]
**テーマディレクトリ**: `artifacts/[THEME_START_ID_themeDirectoryPart]/`

**終了理由**: 
[完了/新テーマ「XXX」へ移行/など]

**主な成果**: 
[重要な成果物や発見の簡潔な説明]
```

#### サブテーマ終了記録 (`_end_` ファイル)

```markdown
# サブテーマ終了: [サブテーマ名]

**PARENT_THEME_START_ID**: [親テーマのTHEME_START_ID]
**PARENT_THEME_NAME**: [親テーマ名]
**THEME_START_ID**: [サブテーマ開始時のハートビートID]
**THEME_END_ID**: [サブテーマ終了時のハートビートID]
**テーマディレクトリ**: `artifacts/[PARENT_THEME_START_ID_親テーマディレクトリ]/subthemes/[THEME_START_ID_サブテーマディレクトリ]/`

**終了理由**: 
[サブテーマ完了/次のサブテーマ「XXX」へ移行/親テーマに戻る/など]

**主な成果**: 
[重要な成果物や発見の簡潔な説明]
```

---

## 7. MCPツール活用ガイド

### 7.1 利用可能なMCPツール

#### `get_latest_activity_log` ツール
**用途**: 指定されたテーマディレクトリ内の最新活動ログファイルの内容を取得

**主な使用場面:**
- 内省活動時の過去ログ参照
- 継続的な思考を行う際の文脈確認
- 活動傾向の分析

**サブテーマ対応**: メインテーマ・サブテーマ両方で使用可能

#### `check_theme_status` ツール
**用途**: 指定されたテーマの現在の状態と統計情報を分析

**主な使用場面:**
- テーマ終了判断前の客観的評価
- テーマ開始前の前テーマ状態確認
- 内省活動時の進捗状況把握
- 活動バランスの分析

**提供される情報:**
- テーマの基本情報（期間、状態、進行状況）
- 活動統計（総数、タイプ分布、最終活動からの経過時間）
- 成果物統計（総数、ファイルタイプ分布、生産性指標）
- 活動パターン分析（頻度、規則性、直近の傾向）
- 推奨事項（内省活動不足の警告など）

**サブテーマ対応**: メインテーマ・サブテーマ両方で使用可能、階層構造も表示

#### `list_theme_artifacts` ツール
**用途**: 指定されたテーマディレクトリ内の成果物ファイルの一覧を取得

**主な使用場面:**
- 創造活動時の過去成果物参照・活用
- 観測活動での成果物蓄積状況の確認
- 内省活動での生産性・成果の振り返り
- テーマ全体の成果物整理・把握

**提供される情報:**
- プロジェクトルートからの絶対パスでの成果物一覧
- 名前順（時系列順）でのソート
- historiesディレクトリ（活動ログ）は除外
- 隠しファイル・システムファイルは自動除外

**サブテーマ対応**: メインテーマ・サブテーマ両方で使用可能、サブテーマ成果物も統合表示

#### `create_theme_log` ツール
**用途**: テーマ・サブテーマ履歴ファイルの作成支援

**使用パターン:**
- **メインテーマ開始**: `action: "start"`
- **サブテーマ開始**: `action: "start"` + 親テーマ情報
- **テーマ終了**: `action: "end"` + `themeEndId`
- **サブテーマ終了**: `action: "end"` + `themeEndId` + 親テーマ情報

**サブテーマ使用時の注意:**
- `parentThemeStartId`と`parentThemeDirectoryPart`は必ずセットで指定
- サブテーマの場合、親テーマ情報が履歴に自動記録される
- 「知っているが意識しない」方針により、統合情報の記録は不要


#### `create_theme_expert_context` ツール
**用途**: テーマ・サブテーマ専門家コンテキストファイルの作成

**使用パターン:**
- **メインテーマ**: 通常の専門家コンテキスト作成
- **サブテーマ**: 親テーマ情報を指定して作成

**サブテーマ使用時の重要な注意:**
- `parentThemeStartId`と`parentThemeDirectoryPart`は必ずセットで指定
- **「知っているが意識しない」方針**: サブテーマの専門家コンテキストには親テーマ情報を含めない
- サブテーマに完全集中したコンテキストを作成する
- 親子関係はシステムレベルで自動管理される
- **兼任専門家の回避**: 複数の独立した専門分野が必要な場合は、兼任専門家ではなくサブテーマ分割を検討する

#### `check_and_process_item` ツール
**用途**: themeboxファイルの自動処理

**使用パターン:**
- **themebox処理**: `type: 'themebox'` で未処理テーマファイルを自動選択・処理
- **feedbackbox処理**: `type: 'feedbackbox'` でフィードバックファイルを自動処理

**利点**: 除外ルールの自動適用、処理済みマーキングの自動実行

### 7.2 MCPツール vs 手動実行の判断基準

#### MCPツール使用を推奨する場合
- **標準的な処理**: 定型的なフォーマットで十分な場合
- **効率重視**: 迅速な処理が必要な場合
- **エラー防止**: 手動でのミスを避けたい場合
- **ログ参照**: 内省活動での過去ログ確認（`get_latest_activity_log`）
- **状態分析**: テーマの客観的評価・判断材料の取得（`check_theme_status`）
- **成果物確認**: 創造・観測活動での過去成果物参照（`list_theme_artifacts`）

#### 手動実行を選択する場合
- **カスタマイズ必要**: 特殊な内容や形式が必要な場合
- **MCPツールエラー**: ツールが利用できない場合
- **学習目的**: 手順を理解したい場合
- **特定ログ参照**: 特定の日時や条件でのログ検索が必要な場合
- **詳細分析**: ツールでは得られない特殊な分析が必要な場合
- **特定ファイル操作**: 個別ファイルの詳細確認や特殊な操作が必要な場合

### 6.3 MCPツール使用時の注意事項

- **警告メッセージ**: 表示された場合は `ai-docs/MCP_WARNING_GUIDE.md` を参照
- **補助手段**: MCPツールは補助であり、手動実行も常に可能
- **エラー時対応**: ツールエラー時は手動での代替実行を検討

---

## 8. エラー時の代替手順

### 8.1 一般的なエラー対応原則

1. **エラー記録**: エラー内容を活動ログに詳細に記録
2. **原因推定**: 可能な限り原因を分析
3. **代替手段実行**: 手動での代替処理を実行
4. **継続判定**: 可能な限り次サイクルに進む

### 8.2 具体的なエラーシナリオと対応

#### MCPツールエラー
**対応手順:**
1. エラー内容を記録
2. 手動でのファイル作成に切り替え
3. 標準フォーマットに従って作成
4. 次回ハートビートでツール再試行を検討

#### ファイル作成エラー
**対応手順:**
1. ディレクトリ存在確認
2. 権限問題の確認
3. 代替パスでの作成試行
4. 最小限の記録で継続

#### themeboxアクセスエラー
**対応手順:**
1. ディレクトリ存在確認
2. 自律的テーマ決定に切り替え
3. エラー内容を記録
4. 次回ハートビートで再確認

### 8.3 重大エラー時の対応

#### 連続エラー（4回連続）
- システム停止を検討
- 停止理由を詳細に記録
- テーマ終了履歴を記録

#### 回復不可能なエラー
- 現在のテーマを緊急終了
- エラー詳細を記録
- 新テーマでの再開を検討

---

## 9. ベストプラクティス

### 9.1 テーマ選択のベストプラクティス

#### 効果的なテーマ選択
- **適度な範囲**: 広すぎず狭すぎない適切なスコープ
- **発展性**: 継続的な探求が可能な領域
- **創造性**: 新しい発見や創造の余地がある分野
- **関連性**: 前テーマとの自然な関連性

#### 避けるべきテーマ
- **過度に狭い**: 数回のハートビートで完了してしまう
- **過度に広い**: 焦点が定まらない
- **技術的制約**: システム制約に抵触する内容

### 9.2 サブテーマ活用のベストプラクティス

#### 効果的なサブテーマ分割
- **適切な粒度**: 5-20ハートビート程度の適度な規模
- **独立性**: 単独でも価値のある探求領域
- **集中性**: 一つの専門領域に特化した内容
- **統合性**: 親テーマへの統合が自然に行える構造

#### サブテーマ判定のタイミング
- **内省活動時**: 客観的な振り返りでの判定が最適
- **活動停滞時**: 同じような内容の繰り返しを感じた時
- **複雑性認識時**: 複数の要素が混在していることに気づいた時

#### 「知っているが意識しない」の実践
- **完全集中**: サブテーマ中は親テーマを意識しない
- **専門性発揮**: サブテーマに特化した深い探求
- **自然な統合**: 終了時に親テーマとの関連を整理

### 9.3 テーマ運用のベストプラクティス

#### 効果的な活動パターン
- **バランス重視**: 思考・観測・創造・内省の循環
- **段階的深化**: 表面から深層へ段階的に探求
- **記録重視**: 発見・洞察の継続的記録
- **関連付け**: 過去の成果との関連性明示

#### 専門家コンテキストの活用
- **適切な設定**: テーマの性質に合った専門家役割
- **柔軟な適用**: システム制約内での専門性発揮
- **継続的評価**: 内省時での適切性評価

### 9.4 記録管理のベストプラクティス

#### 完全な記録
- **タイムスタンプ**: すべての記録に正確な時刻情報
- **関連付け**: THEME_START_ID/THEME_END_IDによる完全な追跡
- **詳細記録**: 判断理由や経緯の詳細記録

#### 効率的な管理
- **MCPツール活用**: 定型処理でのツール使用
- **手動補完**: 特殊ケースでの手動対応
- **エラー対応**: 代替手順の準備と実行

### 9.5 継続性確保のベストプラクティス

#### システム安定性
- **一回一歩**: 各ハートビートでの適切な範囲
- **エラー対応**: 迅速な代替手段実行
- **記録継続**: エラー時でも最小限の記録確保

#### 長期的視点
- **積み重ね重視**: 小さな進歩の継続的蓄積
- **発展的思考**: 初期考えからの変化・発展歓迎
- **学習姿勢**: 過去の経験からの継続的改善

---

## 📚 関連ドキュメント

- `GEMINI.md` - AI心臓システムの基本ルール
- `ai-docs/THEME_CONCEPT_GUIDE.md` - テーマ・サブテーマの基本概念
- `ai-docs/THEME_CONTEXT_IMPLEMENTATION.md` - テーマ専門家コンテキスト
- `ai-docs/OPERATION_DETAILS.md` - 運用詳細ガイド
- `ai-docs/MCP_WARNING_GUIDE.md` - MCPツール使用時の注意事項
- `ai-docs/GUIDELINES.md` - 運用ガイドライン
